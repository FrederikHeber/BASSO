<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 8.6.9">
<meta name="description" content="BASSO is a library written in cpp for solving under- determined or overdetermined linear systems of equations Ax=y.">
<meta name="keywords" content="BASSO, Banach space, minimization, regularization, Tikhonov functional">
<title>BAnach Sequential Subspace Optimizer (BASSO)</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
<script type="text/javascript">
/*<![CDATA[*/
/*
LaTeXMathML.js
==============

This file, in this form, is due to Douglas Woodall, June 2006.
It contains JavaScript functions to convert (most simple) LaTeX
math notation to Presentation MathML.  It was obtained by
downloading the file ASCIIMathML.js from
	http://www1.chapman.edu/~jipsen/mathml/asciimathdownload/
and modifying it so that it carries out ONLY those conversions
that would be carried out in LaTeX.  A description of the original
file, with examples, can be found at
	www1.chapman.edu/~jipsen/mathml/asciimath.html
	ASCIIMathML: Math on the web for everyone

Here is the header notice from the original file:

ASCIIMathML.js
==============
This file contains JavaScript functions to convert ASCII math notation
to Presentation MathML. The conversion is done while the (X)HTML page
loads, and should work with Firefox/Mozilla/Netscape 7+ and Internet
Explorer 6+MathPlayer (http://www.dessci.com/en/products/mathplayer/).
Just add the next line to your (X)HTML page with this file in the same folder:
This is a convenient and inexpensive solution for authoring MathML.

Version 1.4.7 Dec 15, 2005, (c) Peter Jipsen http://www.chapman.edu/~jipsen
Latest version at http://www.chapman.edu/~jipsen/mathml/ASCIIMathML.js
For changes see http://www.chapman.edu/~jipsen/mathml/asciimathchanges.txt
If you use it on a webpage, please send the URL to jipsen@chapman.edu

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or (at
your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
General Public License (at http://www.gnu.org/copyleft/gpl.html)
for more details.

LaTeXMathML.js (ctd)
==============

The instructions for use are the same as for the original
ASCIIMathML.js, except that of course the line you add to your
file should be
Or use absolute path names if the file is not in the same folder
as your (X)HTML page.
*/

var checkForMathML = true;   // check if browser can display MathML
var notifyIfNoMathML = true; // display note if no MathML capability
var alertIfNoMathML = false;  // show alert box if no MathML capability
// was "red":
var mathcolor = "";	     // change it to "" (to inherit) or any other color
// was "serif":
var mathfontfamily = "";      // change to "" to inherit (works in IE)
                              // or another family (e.g. "arial")
var showasciiformulaonhover = true; // helps students learn ASCIIMath
/*
// Commented out by DRW -- not now used -- see DELIMITERS (twice) near the end
var displaystyle = false;     // puts limits above and below large operators
var decimalsign = ".";        // change to "," if you like, beware of `(1,2)`!
var AMdelimiter1 = "`", AMescape1 = "\\\\`"; // can use other characters
var AMdelimiter2 = "$", AMescape2 = "\\\\\\$", AMdelimiter2regexp = "\\$";
var doubleblankmathdelimiter = false; // if true,  x+1  is equal to `x+1`
                                      // for IE this works only in <!--   -->
//var separatetokens;// has been removed (email me if this is a problem)
*/
var isIE = document.createElementNS==null;

if (document.getElementById==null)
  alert("This webpage requires a recent browser such as\
\nMozilla/Netscape 7+ or Internet Explorer 6+MathPlayer")

// all further global variables start with "AM"

function AMcreateElementXHTML(t) {
  if (isIE) return document.createElement(t);
  else return document.createElementNS("http://www.w3.org/1999/xhtml",t);
}

function AMnoMathMLNote() {
  var nd = AMcreateElementXHTML("h3");
  nd.setAttribute("align","center")
  nd.appendChild(AMcreateElementXHTML("p"));
  nd.appendChild(document.createTextNode("To view the "));
  var an = AMcreateElementXHTML("a");
  an.appendChild(document.createTextNode("LaTeXMathML"));
  an.setAttribute("href","http://www.maths.nott.ac.uk/personal/drw/lm.html");
  nd.appendChild(an);
  nd.appendChild(document.createTextNode(" notation use Internet Explorer 6+"));
  an = AMcreateElementXHTML("a");
  an.appendChild(document.createTextNode("MathPlayer"));
  an.setAttribute("href","http://www.dessci.com/en/products/mathplayer/download.htm");
  nd.appendChild(an);
  nd.appendChild(document.createTextNode(" or Netscape/Mozilla/Firefox"));
  nd.appendChild(AMcreateElementXHTML("p"));
  return nd;
}

function AMisMathMLavailable() {
  if (navigator.appName.slice(0,8)=="Netscape")
    if (navigator.appVersion.slice(0,1)>="5") return null;
    else return AMnoMathMLNote();
  else if (navigator.appName.slice(0,9)=="Microsoft")
    try {
        var ActiveX = new ActiveXObject("MathPlayer.Factory.1");
        return null;
    } catch (e) {
        return AMnoMathMLNote();
    }
  else return AMnoMathMLNote();
}

// character lists for Mozilla/Netscape fonts
var AMcal = [0xEF35,0x212C,0xEF36,0xEF37,0x2130,0x2131,0xEF38,0x210B,0x2110,0xEF39,0xEF3A,0x2112,0x2133,0xEF3B,0xEF3C,0xEF3D,0xEF3E,0x211B,0xEF3F,0xEF40,0xEF41,0xEF42,0xEF43,0xEF44,0xEF45,0xEF46];
var AMfrk = [0xEF5D,0xEF5E,0x212D,0xEF5F,0xEF60,0xEF61,0xEF62,0x210C,0x2111,0xEF63,0xEF64,0xEF65,0xEF66,0xEF67,0xEF68,0xEF69,0xEF6A,0x211C,0xEF6B,0xEF6C,0xEF6D,0xEF6E,0xEF6F,0xEF70,0xEF71,0x2128];
var AMbbb = [0xEF8C,0xEF8D,0x2102,0xEF8E,0xEF8F,0xEF90,0xEF91,0x210D,0xEF92,0xEF93,0xEF94,0xEF95,0xEF96,0x2115,0xEF97,0x2119,0x211A,0x211D,0xEF98,0xEF99,0xEF9A,0xEF9B,0xEF9C,0xEF9D,0xEF9E,0x2124];

var CONST = 0, UNARY = 1, BINARY = 2, INFIX = 3, LEFTBRACKET = 4,
    RIGHTBRACKET = 5, SPACE = 6, UNDEROVER = 7, DEFINITION = 8,
    TEXT = 9, BIG = 10, LONG = 11, STRETCHY = 12, MATRIX = 13; // token types

var AMsqrt = {input:"\\sqrt",	tag:"msqrt", output:"sqrt",	ttype:UNARY},
  AMroot = {input:"\\root",	tag:"mroot", output:"root",	ttype:BINARY},
  AMfrac = {input:"\\frac",	tag:"mfrac", output:"/",	ttype:BINARY},
  AMover = {input:"\\stackrel", tag:"mover", output:"stackrel", ttype:BINARY},
  AMatop = {input:"\\atop",	tag:"mfrac", output:"",		ttype:INFIX},
  AMchoose = {input:"\\choose", tag:"mfrac", output:"",		ttype:INFIX},
  AMsub  = {input:"_",		tag:"msub",  output:"_",	ttype:INFIX},
  AMsup  = {input:"^",		tag:"msup",  output:"^",	ttype:INFIX},
  AMtext = {input:"\\mathrm",	tag:"mtext", output:"text",	ttype:TEXT},
  AMmbox = {input:"\\mbox",	tag:"mtext", output:"mbox",	ttype:TEXT};

// Commented out by DRW to prevent 1/2 turning into a 2-line fraction
// AMdiv   = {input:"/",	 tag:"mfrac", output:"/",    ttype:INFIX},
// Commented out by DRW so that " prints literally in equations
// AMquote = {input:"\"",	 tag:"mtext", output:"mbox", ttype:TEXT};

var AMsymbols = [
//Greek letters
{input:"\\alpha",	tag:"mi", output:"\u03B1", ttype:CONST},
{input:"\\beta",	tag:"mi", output:"\u03B2", ttype:CONST},
{input:"\\gamma",	tag:"mi", output:"\u03B3", ttype:CONST},
{input:"\\delta",	tag:"mi", output:"\u03B4", ttype:CONST},
{input:"\\epsilon",	tag:"mi", output:"\u03B5", ttype:CONST},
{input:"\\varepsilon",  tag:"mi", output:"\u025B", ttype:CONST},
{input:"\\zeta",	tag:"mi", output:"\u03B6", ttype:CONST},
{input:"\\eta",		tag:"mi", output:"\u03B7", ttype:CONST},
{input:"\\theta",	tag:"mi", output:"\u03B8", ttype:CONST},
{input:"\\vartheta",	tag:"mi", output:"\u03D1", ttype:CONST},
{input:"\\iota",	tag:"mi", output:"\u03B9", ttype:CONST},
{input:"\\kappa",	tag:"mi", output:"\u03BA", ttype:CONST},
{input:"\\lambda",	tag:"mi", output:"\u03BB", ttype:CONST},
{input:"\\mu",		tag:"mi", output:"\u03BC", ttype:CONST},
{input:"\\nu",		tag:"mi", output:"\u03BD", ttype:CONST},
{input:"\\xi",		tag:"mi", output:"\u03BE", ttype:CONST},
{input:"\\pi",		tag:"mi", output:"\u03C0", ttype:CONST},
{input:"\\varpi",	tag:"mi", output:"\u03D6", ttype:CONST},
{input:"\\rho",		tag:"mi", output:"\u03C1", ttype:CONST},
{input:"\\varrho",	tag:"mi", output:"\u03F1", ttype:CONST},
{input:"\\varsigma",	tag:"mi", output:"\u03C2", ttype:CONST},
{input:"\\sigma",	tag:"mi", output:"\u03C3", ttype:CONST},
{input:"\\tau",		tag:"mi", output:"\u03C4", ttype:CONST},
{input:"\\upsilon",	tag:"mi", output:"\u03C5", ttype:CONST},
{input:"\\phi",		tag:"mi", output:"\u03C6", ttype:CONST},
{input:"\\varphi",	tag:"mi", output:"\u03D5", ttype:CONST},
{input:"\\chi",		tag:"mi", output:"\u03C7", ttype:CONST},
{input:"\\psi",		tag:"mi", output:"\u03C8", ttype:CONST},
{input:"\\omega",	tag:"mi", output:"\u03C9", ttype:CONST},
{input:"\\Gamma",	tag:"mo", output:"\u0393", ttype:CONST},
{input:"\\Delta",	tag:"mo", output:"\u0394", ttype:CONST},
{input:"\\Theta",	tag:"mo", output:"\u0398", ttype:CONST},
{input:"\\Lambda",	tag:"mo", output:"\u039B", ttype:CONST},
{input:"\\Xi",		tag:"mo", output:"\u039E", ttype:CONST},
{input:"\\Pi",		tag:"mo", output:"\u03A0", ttype:CONST},
{input:"\\Sigma",	tag:"mo", output:"\u03A3", ttype:CONST},
{input:"\\Upsilon",	tag:"mo", output:"\u03A5", ttype:CONST},
{input:"\\Phi",		tag:"mo", output:"\u03A6", ttype:CONST},
{input:"\\Psi",		tag:"mo", output:"\u03A8", ttype:CONST},
{input:"\\Omega",	tag:"mo", output:"\u03A9", ttype:CONST},

//fractions
{input:"\\frac12",	tag:"mo", output:"\u00BD", ttype:CONST},
{input:"\\frac14",	tag:"mo", output:"\u00BC", ttype:CONST},
{input:"\\frac34",	tag:"mo", output:"\u00BE", ttype:CONST},
{input:"\\frac13",	tag:"mo", output:"\u2153", ttype:CONST},
{input:"\\frac23",	tag:"mo", output:"\u2154", ttype:CONST},
{input:"\\frac15",	tag:"mo", output:"\u2155", ttype:CONST},
{input:"\\frac25",	tag:"mo", output:"\u2156", ttype:CONST},
{input:"\\frac35",	tag:"mo", output:"\u2157", ttype:CONST},
{input:"\\frac45",	tag:"mo", output:"\u2158", ttype:CONST},
{input:"\\frac16",	tag:"mo", output:"\u2159", ttype:CONST},
{input:"\\frac56",	tag:"mo", output:"\u215A", ttype:CONST},
{input:"\\frac18",	tag:"mo", output:"\u215B", ttype:CONST},
{input:"\\frac38",	tag:"mo", output:"\u215C", ttype:CONST},
{input:"\\frac58",	tag:"mo", output:"\u215D", ttype:CONST},
{input:"\\frac78",	tag:"mo", output:"\u215E", ttype:CONST},

//binary operation symbols
{input:"\\pm",		tag:"mo", output:"\u00B1", ttype:CONST},
{input:"\\mp",		tag:"mo", output:"\u2213", ttype:CONST},
{input:"\\triangleleft",tag:"mo", output:"\u22B2", ttype:CONST},
{input:"\\triangleright",tag:"mo",output:"\u22B3", ttype:CONST},
{input:"\\cdot",	tag:"mo", output:"\u22C5", ttype:CONST},
{input:"\\star",	tag:"mo", output:"\u22C6", ttype:CONST},
{input:"\\ast",		tag:"mo", output:"\u002A", ttype:CONST},
{input:"\\times",	tag:"mo", output:"\u00D7", ttype:CONST},
{input:"\\div",		tag:"mo", output:"\u00F7", ttype:CONST},
{input:"\\circ",	tag:"mo", output:"\u2218", ttype:CONST},
//{input:"\\bullet",	  tag:"mo", output:"\u2219", ttype:CONST},
{input:"\\bullet",	tag:"mo", output:"\u2022", ttype:CONST},
{input:"\\oplus",	tag:"mo", output:"\u2295", ttype:CONST},
{input:"\\ominus",	tag:"mo", output:"\u2296", ttype:CONST},
{input:"\\otimes",	tag:"mo", output:"\u2297", ttype:CONST},
{input:"\\bigcirc",	tag:"mo", output:"\u25CB", ttype:CONST},
{input:"\\oslash",	tag:"mo", output:"\u2298", ttype:CONST},
{input:"\\odot",	tag:"mo", output:"\u2299", ttype:CONST},
{input:"\\land",	tag:"mo", output:"\u2227", ttype:CONST},
{input:"\\wedge",	tag:"mo", output:"\u2227", ttype:CONST},
{input:"\\lor",		tag:"mo", output:"\u2228", ttype:CONST},
{input:"\\vee",		tag:"mo", output:"\u2228", ttype:CONST},
{input:"\\cap",		tag:"mo", output:"\u2229", ttype:CONST},
{input:"\\cup",		tag:"mo", output:"\u222A", ttype:CONST},
{input:"\\sqcap",	tag:"mo", output:"\u2293", ttype:CONST},
{input:"\\sqcup",	tag:"mo", output:"\u2294", ttype:CONST},
{input:"\\uplus",	tag:"mo", output:"\u228E", ttype:CONST},
{input:"\\amalg",	tag:"mo", output:"\u2210", ttype:CONST},
{input:"\\bigtriangleup",tag:"mo",output:"\u25B3", ttype:CONST},
{input:"\\bigtriangledown",tag:"mo",output:"\u25BD", ttype:CONST},
{input:"\\dag",		tag:"mo", output:"\u2020", ttype:CONST},
{input:"\\dagger",	tag:"mo", output:"\u2020", ttype:CONST},
{input:"\\ddag",	tag:"mo", output:"\u2021", ttype:CONST},
{input:"\\ddagger",	tag:"mo", output:"\u2021", ttype:CONST},
{input:"\\lhd",		tag:"mo", output:"\u22B2", ttype:CONST},
{input:"\\rhd",		tag:"mo", output:"\u22B3", ttype:CONST},
{input:"\\unlhd",	tag:"mo", output:"\u22B4", ttype:CONST},
{input:"\\unrhd",	tag:"mo", output:"\u22B5", ttype:CONST},


//BIG Operators
{input:"\\sum",		tag:"mo", output:"\u2211", ttype:UNDEROVER},
{input:"\\prod",	tag:"mo", output:"\u220F", ttype:UNDEROVER},
{input:"\\bigcap",	tag:"mo", output:"\u22C2", ttype:UNDEROVER},
{input:"\\bigcup",	tag:"mo", output:"\u22C3", ttype:UNDEROVER},
{input:"\\bigwedge",	tag:"mo", output:"\u22C0", ttype:UNDEROVER},
{input:"\\bigvee",	tag:"mo", output:"\u22C1", ttype:UNDEROVER},
{input:"\\bigsqcap",	tag:"mo", output:"\u2A05", ttype:UNDEROVER},
{input:"\\bigsqcup",	tag:"mo", output:"\u2A06", ttype:UNDEROVER},
{input:"\\coprod",	tag:"mo", output:"\u2210", ttype:UNDEROVER},
{input:"\\bigoplus",	tag:"mo", output:"\u2A01", ttype:UNDEROVER},
{input:"\\bigotimes",	tag:"mo", output:"\u2A02", ttype:UNDEROVER},
{input:"\\bigodot",	tag:"mo", output:"\u2A00", ttype:UNDEROVER},
{input:"\\biguplus",	tag:"mo", output:"\u2A04", ttype:UNDEROVER},
{input:"\\int",		tag:"mo", output:"\u222B", ttype:CONST},
{input:"\\oint",	tag:"mo", output:"\u222E", ttype:CONST},

//binary relation symbols
{input:":=",		tag:"mo", output:":=",	   ttype:CONST},
{input:"\\lt",		tag:"mo", output:"<",	   ttype:CONST},
{input:"\\gt",		tag:"mo", output:">",	   ttype:CONST},
{input:"\\ne",		tag:"mo", output:"\u2260", ttype:CONST},
{input:"\\neq",		tag:"mo", output:"\u2260", ttype:CONST},
{input:"\\le",		tag:"mo", output:"\u2264", ttype:CONST},
{input:"\\leq",		tag:"mo", output:"\u2264", ttype:CONST},
{input:"\\leqslant",	tag:"mo", output:"\u2264", ttype:CONST},
{input:"\\ge",		tag:"mo", output:"\u2265", ttype:CONST},
{input:"\\geq",		tag:"mo", output:"\u2265", ttype:CONST},
{input:"\\geqslant",	tag:"mo", output:"\u2265", ttype:CONST},
{input:"\\equiv",	tag:"mo", output:"\u2261", ttype:CONST},
{input:"\\ll",		tag:"mo", output:"\u226A", ttype:CONST},
{input:"\\gg",		tag:"mo", output:"\u226B", ttype:CONST},
{input:"\\doteq",	tag:"mo", output:"\u2250", ttype:CONST},
{input:"\\prec",	tag:"mo", output:"\u227A", ttype:CONST},
{input:"\\succ",	tag:"mo", output:"\u227B", ttype:CONST},
{input:"\\preceq",	tag:"mo", output:"\u227C", ttype:CONST},
{input:"\\succeq",	tag:"mo", output:"\u227D", ttype:CONST},
{input:"\\subset",	tag:"mo", output:"\u2282", ttype:CONST},
{input:"\\supset",	tag:"mo", output:"\u2283", ttype:CONST},
{input:"\\subseteq",	tag:"mo", output:"\u2286", ttype:CONST},
{input:"\\supseteq",	tag:"mo", output:"\u2287", ttype:CONST},
{input:"\\sqsubset",	tag:"mo", output:"\u228F", ttype:CONST},
{input:"\\sqsupset",	tag:"mo", output:"\u2290", ttype:CONST},
{input:"\\sqsubseteq",  tag:"mo", output:"\u2291", ttype:CONST},
{input:"\\sqsupseteq",  tag:"mo", output:"\u2292", ttype:CONST},
{input:"\\sim",		tag:"mo", output:"\u223C", ttype:CONST},
{input:"\\simeq",	tag:"mo", output:"\u2243", ttype:CONST},
{input:"\\approx",	tag:"mo", output:"\u2248", ttype:CONST},
{input:"\\cong",	tag:"mo", output:"\u2245", ttype:CONST},
{input:"\\Join",	tag:"mo", output:"\u22C8", ttype:CONST},
{input:"\\bowtie",	tag:"mo", output:"\u22C8", ttype:CONST},
{input:"\\in",		tag:"mo", output:"\u2208", ttype:CONST},
{input:"\\ni",		tag:"mo", output:"\u220B", ttype:CONST},
{input:"\\owns",	tag:"mo", output:"\u220B", ttype:CONST},
{input:"\\propto",	tag:"mo", output:"\u221D", ttype:CONST},
{input:"\\vdash",	tag:"mo", output:"\u22A2", ttype:CONST},
{input:"\\dashv",	tag:"mo", output:"\u22A3", ttype:CONST},
{input:"\\models",	tag:"mo", output:"\u22A8", ttype:CONST},
{input:"\\perp",	tag:"mo", output:"\u22A5", ttype:CONST},
{input:"\\smile",	tag:"mo", output:"\u2323", ttype:CONST},
{input:"\\frown",	tag:"mo", output:"\u2322", ttype:CONST},
{input:"\\asymp",	tag:"mo", output:"\u224D", ttype:CONST},
{input:"\\notin",	tag:"mo", output:"\u2209", ttype:CONST},

//matrices
{input:"\\begin{eqnarray}",	output:"X",	ttype:MATRIX, invisible:true},
{input:"\\begin{array}",	output:"X",	ttype:MATRIX, invisible:true},
{input:"\\\\",			output:"}&{",	ttype:DEFINITION},
{input:"\\end{eqnarray}",	output:"}}",	ttype:DEFINITION},
{input:"\\end{array}",		output:"}}",	ttype:DEFINITION},

//grouping and literal brackets -- ieval is for IE
{input:"\\big",	   tag:"mo", output:"X", atval:"1.2", ieval:"2.2", ttype:BIG},
{input:"\\Big",	   tag:"mo", output:"X", atval:"1.6", ieval:"2.6", ttype:BIG},
{input:"\\bigg",   tag:"mo", output:"X", atval:"2.2", ieval:"3.2", ttype:BIG},
{input:"\\Bigg",   tag:"mo", output:"X", atval:"2.9", ieval:"3.9", ttype:BIG},
{input:"\\left",   tag:"mo", output:"X", ttype:LEFTBRACKET},
{input:"\\right",  tag:"mo", output:"X", ttype:RIGHTBRACKET},
{input:"{",	   output:"{", ttype:LEFTBRACKET,  invisible:true},
{input:"}",	   output:"}", ttype:RIGHTBRACKET, invisible:true},

{input:"(",	   tag:"mo", output:"(",      atval:"1", ttype:STRETCHY},
{input:"[",	   tag:"mo", output:"[",      atval:"1", ttype:STRETCHY},
{input:"\\lbrack", tag:"mo", output:"[",      atval:"1", ttype:STRETCHY},
{input:"\\{",	   tag:"mo", output:"{",      atval:"1", ttype:STRETCHY},
{input:"\\lbrace", tag:"mo", output:"{",      atval:"1", ttype:STRETCHY},
{input:"\\langle", tag:"mo", output:"\u2329", atval:"1", ttype:STRETCHY},
{input:"\\lfloor", tag:"mo", output:"\u230A", atval:"1", ttype:STRETCHY},
{input:"\\lceil",  tag:"mo", output:"\u2308", atval:"1", ttype:STRETCHY},

// rtag:"mi" causes space to be inserted before a following sin, cos, etc.
// (see function AMparseExpr() )
{input:")",	  tag:"mo",output:")",	    rtag:"mi",atval:"1",ttype:STRETCHY},
{input:"]",	  tag:"mo",output:"]",	    rtag:"mi",atval:"1",ttype:STRETCHY},
{input:"\\rbrack",tag:"mo",output:"]",	    rtag:"mi",atval:"1",ttype:STRETCHY},
{input:"\\}",	  tag:"mo",output:"}",	    rtag:"mi",atval:"1",ttype:STRETCHY},
{input:"\\rbrace",tag:"mo",output:"}",	    rtag:"mi",atval:"1",ttype:STRETCHY},
{input:"\\rangle",tag:"mo",output:"\u232A", rtag:"mi",atval:"1",ttype:STRETCHY},
{input:"\\rfloor",tag:"mo",output:"\u230B", rtag:"mi",atval:"1",ttype:STRETCHY},
{input:"\\rceil", tag:"mo",output:"\u2309", rtag:"mi",atval:"1",ttype:STRETCHY},

// "|", "\\|", "\\vert" and "\\Vert" modified later: lspace = rspace = 0em
{input:"|",		tag:"mo", output:"\u2223", atval:"1", ttype:STRETCHY},
{input:"\\|",		tag:"mo", output:"\u2225", atval:"1", ttype:STRETCHY},
{input:"\\vert",	tag:"mo", output:"\u2223", atval:"1", ttype:STRETCHY},
{input:"\\Vert",	tag:"mo", output:"\u2225", atval:"1", ttype:STRETCHY},
{input:"\\mid",		tag:"mo", output:"\u2223", atval:"1", ttype:STRETCHY},
{input:"\\parallel",	tag:"mo", output:"\u2225", atval:"1", ttype:STRETCHY},
{input:"/",		tag:"mo", output:"/",	atval:"1.01", ttype:STRETCHY},
{input:"\\backslash",	tag:"mo", output:"\u2216", atval:"1", ttype:STRETCHY},
{input:"\\setminus",	tag:"mo", output:"\\",	   ttype:CONST},

//miscellaneous symbols
{input:"\\!",	  tag:"mspace", atname:"width", atval:"-0.167em", ttype:SPACE},
{input:"\\,",	  tag:"mspace", atname:"width", atval:"0.167em", ttype:SPACE},
{input:"\\>",	  tag:"mspace", atname:"width", atval:"0.222em", ttype:SPACE},
{input:"\\:",	  tag:"mspace", atname:"width", atval:"0.222em", ttype:SPACE},
{input:"\\;",	  tag:"mspace", atname:"width", atval:"0.278em", ttype:SPACE},
{input:"~",	  tag:"mspace", atname:"width", atval:"0.333em", ttype:SPACE},
{input:"\\quad",  tag:"mspace", atname:"width", atval:"1em", ttype:SPACE},
{input:"\\qquad", tag:"mspace", atname:"width", atval:"2em", ttype:SPACE},
//{input:"{}",		  tag:"mo", output:"\u200B", ttype:CONST}, // zero-width
{input:"\\prime",	tag:"mo", output:"\u2032", ttype:CONST},
{input:"'",		tag:"mo", output:"\u02B9", ttype:CONST},
{input:"''",		tag:"mo", output:"\u02BA", ttype:CONST},
{input:"'''",		tag:"mo", output:"\u2034", ttype:CONST},
{input:"''''",		tag:"mo", output:"\u2057", ttype:CONST},
{input:"\\ldots",	tag:"mo", output:"\u2026", ttype:CONST},
{input:"\\cdots",	tag:"mo", output:"\u22EF", ttype:CONST},
{input:"\\vdots",	tag:"mo", output:"\u22EE", ttype:CONST},
{input:"\\ddots",	tag:"mo", output:"\u22F1", ttype:CONST},
{input:"\\forall",	tag:"mo", output:"\u2200", ttype:CONST},
{input:"\\exists",	tag:"mo", output:"\u2203", ttype:CONST},
{input:"\\Re",		tag:"mo", output:"\u211C", ttype:CONST},
{input:"\\Im",		tag:"mo", output:"\u2111", ttype:CONST},
{input:"\\aleph",	tag:"mo", output:"\u2135", ttype:CONST},
{input:"\\hbar",	tag:"mo", output:"\u210F", ttype:CONST},
{input:"\\ell",		tag:"mo", output:"\u2113", ttype:CONST},
{input:"\\wp",		tag:"mo", output:"\u2118", ttype:CONST},
{input:"\\emptyset",	tag:"mo", output:"\u2205", ttype:CONST},
{input:"\\infty",	tag:"mo", output:"\u221E", ttype:CONST},
{input:"\\surd",	tag:"mo", output:"\\sqrt{}", ttype:DEFINITION},
{input:"\\partial",	tag:"mo", output:"\u2202", ttype:CONST},
{input:"\\nabla",	tag:"mo", output:"\u2207", ttype:CONST},
{input:"\\triangle",	tag:"mo", output:"\u25B3", ttype:CONST},
{input:"\\therefore",	tag:"mo", output:"\u2234", ttype:CONST},
{input:"\\angle",	tag:"mo", output:"\u2220", ttype:CONST},
//{input:"\\\\ ",	  tag:"mo", output:"\u00A0", ttype:CONST},
{input:"\\diamond",	tag:"mo", output:"\u22C4", ttype:CONST},
//{input:"\\Diamond",	  tag:"mo", output:"\u25CA", ttype:CONST},
{input:"\\Diamond",	tag:"mo", output:"\u25C7", ttype:CONST},
{input:"\\neg",		tag:"mo", output:"\u00AC", ttype:CONST},
{input:"\\lnot",	tag:"mo", output:"\u00AC", ttype:CONST},
{input:"\\bot",		tag:"mo", output:"\u22A5", ttype:CONST},
{input:"\\top",		tag:"mo", output:"\u22A4", ttype:CONST},
{input:"\\square",	tag:"mo", output:"\u25AB", ttype:CONST},
{input:"\\Box",		tag:"mo", output:"\u25A1", ttype:CONST},
{input:"\\wr",		tag:"mo", output:"\u2240", ttype:CONST},

//standard functions
//Note UNDEROVER *must* have tag:"mo" to work properly
{input:"\\arccos", tag:"mi", output:"arccos", ttype:UNARY, func:true},
{input:"\\arcsin", tag:"mi", output:"arcsin", ttype:UNARY, func:true},
{input:"\\arctan", tag:"mi", output:"arctan", ttype:UNARY, func:true},
{input:"\\arg",	   tag:"mi", output:"arg",    ttype:UNARY, func:true},
{input:"\\cos",	   tag:"mi", output:"cos",    ttype:UNARY, func:true},
{input:"\\cosh",   tag:"mi", output:"cosh",   ttype:UNARY, func:true},
{input:"\\cot",	   tag:"mi", output:"cot",    ttype:UNARY, func:true},
{input:"\\coth",   tag:"mi", output:"coth",   ttype:UNARY, func:true},
{input:"\\csc",	   tag:"mi", output:"csc",    ttype:UNARY, func:true},
{input:"\\deg",	   tag:"mi", output:"deg",    ttype:UNARY, func:true},
{input:"\\det",	   tag:"mi", output:"det",    ttype:UNARY, func:true},
{input:"\\dim",	   tag:"mi", output:"dim",    ttype:UNARY, func:true}, //CONST?
{input:"\\exp",	   tag:"mi", output:"exp",    ttype:UNARY, func:true},
{input:"\\gcd",	   tag:"mi", output:"gcd",    ttype:UNARY, func:true}, //CONST?
{input:"\\hom",	   tag:"mi", output:"hom",    ttype:UNARY, func:true},
{input:"\\inf",	      tag:"mo", output:"inf",	 ttype:UNDEROVER},
{input:"\\ker",	   tag:"mi", output:"ker",    ttype:UNARY, func:true},
{input:"\\lg",	   tag:"mi", output:"lg",     ttype:UNARY, func:true},
{input:"\\lim",	      tag:"mo", output:"lim",	 ttype:UNDEROVER},
{input:"\\liminf",    tag:"mo", output:"liminf", ttype:UNDEROVER},
{input:"\\limsup",    tag:"mo", output:"limsup", ttype:UNDEROVER},
{input:"\\ln",	   tag:"mi", output:"ln",     ttype:UNARY, func:true},
{input:"\\log",	   tag:"mi", output:"log",    ttype:UNARY, func:true},
{input:"\\max",	      tag:"mo", output:"max",	 ttype:UNDEROVER},
{input:"\\min",	      tag:"mo", output:"min",	 ttype:UNDEROVER},
{input:"\\Pr",	   tag:"mi", output:"Pr",     ttype:UNARY, func:true},
{input:"\\sec",	   tag:"mi", output:"sec",    ttype:UNARY, func:true},
{input:"\\sin",	   tag:"mi", output:"sin",    ttype:UNARY, func:true},
{input:"\\sinh",   tag:"mi", output:"sinh",   ttype:UNARY, func:true},
{input:"\\sup",	      tag:"mo", output:"sup",	 ttype:UNDEROVER},
{input:"\\tan",	   tag:"mi", output:"tan",    ttype:UNARY, func:true},
{input:"\\tanh",   tag:"mi", output:"tanh",   ttype:UNARY, func:true},

//arrows
{input:"\\gets",		tag:"mo", output:"\u2190", ttype:CONST},
{input:"\\leftarrow",		tag:"mo", output:"\u2190", ttype:CONST},
{input:"\\to",			tag:"mo", output:"\u2192", ttype:CONST},
{input:"\\rightarrow",		tag:"mo", output:"\u2192", ttype:CONST},
{input:"\\leftrightarrow",	tag:"mo", output:"\u2194", ttype:CONST},
{input:"\\uparrow",		tag:"mo", output:"\u2191", ttype:CONST},
{input:"\\downarrow",		tag:"mo", output:"\u2193", ttype:CONST},
{input:"\\updownarrow",		tag:"mo", output:"\u2195", ttype:CONST},
{input:"\\Leftarrow",		tag:"mo", output:"\u21D0", ttype:CONST},
{input:"\\Rightarrow",		tag:"mo", output:"\u21D2", ttype:CONST},
{input:"\\Leftrightarrow",	tag:"mo", output:"\u21D4", ttype:CONST},
{input:"\\iff", tag:"mo", output:"~\\Longleftrightarrow~", ttype:DEFINITION},
{input:"\\Uparrow",		tag:"mo", output:"\u21D1", ttype:CONST},
{input:"\\Downarrow",		tag:"mo", output:"\u21D3", ttype:CONST},
{input:"\\Updownarrow",		tag:"mo", output:"\u21D5", ttype:CONST},
{input:"\\mapsto",		tag:"mo", output:"\u21A6", ttype:CONST},
{input:"\\longleftarrow",	tag:"mo", output:"\u2190", ttype:LONG},
{input:"\\longrightarrow",	tag:"mo", output:"\u2192", ttype:LONG},
{input:"\\longleftrightarrow",	tag:"mo", output:"\u2194", ttype:LONG},
{input:"\\Longleftarrow",	tag:"mo", output:"\u21D0", ttype:LONG},
{input:"\\Longrightarrow",	tag:"mo", output:"\u21D2", ttype:LONG},
{input:"\\Longleftrightarrow",  tag:"mo", output:"\u21D4", ttype:LONG},
{input:"\\longmapsto",		tag:"mo", output:"\u21A6", ttype:CONST},
							// disaster if LONG

//commands with argument
AMsqrt, AMroot, AMfrac, AMover, AMsub, AMsup, AMtext, AMmbox, AMatop, AMchoose,
//AMdiv, AMquote,

//diacritical marks
{input:"\\acute",	tag:"mover",  output:"\u00B4", ttype:UNARY, acc:true},
//{input:"\\acute",	  tag:"mover",  output:"\u0317", ttype:UNARY, acc:true},
//{input:"\\acute",	  tag:"mover",  output:"\u0301", ttype:UNARY, acc:true},
//{input:"\\grave",	  tag:"mover",  output:"\u0300", ttype:UNARY, acc:true},
//{input:"\\grave",	  tag:"mover",  output:"\u0316", ttype:UNARY, acc:true},
{input:"\\grave",	tag:"mover",  output:"\u0060", ttype:UNARY, acc:true},
{input:"\\breve",	tag:"mover",  output:"\u02D8", ttype:UNARY, acc:true},
{input:"\\check",	tag:"mover",  output:"\u02C7", ttype:UNARY, acc:true},
{input:"\\dot",		tag:"mover",  output:".",      ttype:UNARY, acc:true},
{input:"\\ddot",	tag:"mover",  output:"..",     ttype:UNARY, acc:true},
//{input:"\\ddot",	  tag:"mover",  output:"\u00A8", ttype:UNARY, acc:true},
{input:"\\mathring",	tag:"mover",  output:"\u00B0", ttype:UNARY, acc:true},
{input:"\\vec",		tag:"mover",  output:"\u20D7", ttype:UNARY, acc:true},
{input:"\\overrightarrow",tag:"mover",output:"\u20D7", ttype:UNARY, acc:true},
{input:"\\overleftarrow",tag:"mover", output:"\u20D6", ttype:UNARY, acc:true},
{input:"\\hat",		tag:"mover",  output:"\u005E", ttype:UNARY, acc:true},
{input:"\\widehat",	tag:"mover",  output:"\u0302", ttype:UNARY, acc:true},
{input:"\\tilde",	tag:"mover",  output:"~",      ttype:UNARY, acc:true},
//{input:"\\tilde",	  tag:"mover",  output:"\u0303", ttype:UNARY, acc:true},
{input:"\\widetilde",	tag:"mover",  output:"\u02DC", ttype:UNARY, acc:true},
{input:"\\bar",		tag:"mover",  output:"\u203E", ttype:UNARY, acc:true},
{input:"\\overbrace",	tag:"mover",  output:"\u23B4", ttype:UNARY, acc:true},
{input:"\\overline",	tag:"mover",  output:"\u00AF", ttype:UNARY, acc:true},
{input:"\\underbrace",  tag:"munder", output:"\u23B5", ttype:UNARY, acc:true},
{input:"\\underline",	tag:"munder", output:"\u00AF", ttype:UNARY, acc:true},
//{input:"underline",	tag:"munder", output:"\u0332", ttype:UNARY, acc:true},

//typestyles and fonts
{input:"\\displaystyle",tag:"mstyle",atname:"displaystyle",atval:"true", ttype:UNARY},
{input:"\\textstyle",tag:"mstyle",atname:"displaystyle",atval:"false", ttype:UNARY},
{input:"\\scriptstyle",tag:"mstyle",atname:"scriptlevel",atval:"1", ttype:UNARY},
{input:"\\scriptscriptstyle",tag:"mstyle",atname:"scriptlevel",atval:"2", ttype:UNARY},
{input:"\\textrm", tag:"mstyle", output:"\\mathrm", ttype: DEFINITION},
{input:"\\mathbf", tag:"mstyle", atname:"mathvariant", atval:"bold", ttype:UNARY},
{input:"\\textbf", tag:"mstyle", atname:"mathvariant", atval:"bold", ttype:UNARY},
{input:"\\mathit", tag:"mstyle", atname:"mathvariant", atval:"italic", ttype:UNARY},
{input:"\\textit", tag:"mstyle", atname:"mathvariant", atval:"italic", ttype:UNARY},
{input:"\\mathtt", tag:"mstyle", atname:"mathvariant", atval:"monospace", ttype:UNARY},
{input:"\\texttt", tag:"mstyle", atname:"mathvariant", atval:"monospace", ttype:UNARY},
{input:"\\mathsf", tag:"mstyle", atname:"mathvariant", atval:"sans-serif", ttype:UNARY},
{input:"\\mathbb", tag:"mstyle", atname:"mathvariant", atval:"double-struck", ttype:UNARY, codes:AMbbb},
{input:"\\mathcal",tag:"mstyle", atname:"mathvariant", atval:"script", ttype:UNARY, codes:AMcal},
{input:"\\mathfrak",tag:"mstyle",atname:"mathvariant", atval:"fraktur",ttype:UNARY, codes:AMfrk}
];

function compareNames(s1,s2) {
  if (s1.input > s2.input) return 1
  else return -1;
}

var AMnames = []; //list of input symbols

function AMinitSymbols() {
  AMsymbols.sort(compareNames);
  for (i=0; i<AMsymbols.length; i++) AMnames[i] = AMsymbols[i].input;
}

var AMmathml = "http://www.w3.org/1998/Math/MathML";

function AMcreateElementMathML(t) {
  if (isIE) return document.createElement("m:"+t);
  else return document.createElementNS(AMmathml,t);
}

function AMcreateMmlNode(t,frag) {
//  var node = AMcreateElementMathML(name);
  if (isIE) var node = document.createElement("m:"+t);
  else var node = document.createElementNS(AMmathml,t);
  node.appendChild(frag);
  return node;
}

function newcommand(oldstr,newstr) {
  AMsymbols = AMsymbols.concat([{input:oldstr, tag:"mo", output:newstr,
                                 ttype:DEFINITION}]);
}

function AMremoveCharsAndBlanks(str,n) {
//remove n characters and any following blanks
  var st;
  st = str.slice(n);
  for (var i=0; i<st.length && st.charCodeAt(i)<=32; i=i+1);
  return st.slice(i);
}

function AMposition(arr, str, n) {
// return position >=n where str appears or would be inserted
// assumes arr is sorted
  if (n==0) {
    var h,m;
    n = -1;
    h = arr.length;
    while (n+1<h) {
      m = (n+h) >> 1;
      if (arr[m]<str) n = m; else h = m;
    }
    return h;
  } else
    for (var i=n; i<arr.length && arr[i]<str; i++);
  return i; // i=arr.length || arr[i]>=str
}

function AMgetSymbol(str) {
//return maximal initial substring of str that appears in names
//return null if there is none
  var k = 0; //new pos
  var j = 0; //old pos
  var mk; //match pos
  var st;
  var tagst;
  var match = "";
  var more = true;
  for (var i=1; i<=str.length && more; i++) {
    st = str.slice(0,i); //initial substring of length i
    j = k;
    k = AMposition(AMnames, st, j);
    if (k<AMnames.length && str.slice(0,AMnames[k].length)==AMnames[k]){
      match = AMnames[k];
      mk = k;
      i = match.length;
    }
    more = k<AMnames.length && str.slice(0,AMnames[k].length)>=AMnames[k];
  }
  AMpreviousSymbol=AMcurrentSymbol;
  if (match!=""){
    AMcurrentSymbol=AMsymbols[mk].ttype;
    return AMsymbols[mk];
  }
  AMcurrentSymbol=CONST;
  k = 1;
  st = str.slice(0,1); //take 1 character
  if ("0"<=st && st<="9") tagst = "mn";
  else tagst = (("A">st || st>"Z") && ("a">st || st>"z")?"mo":"mi");
/*
// Commented out by DRW (not fully understood, but probably to do with
// use of "/" as an INFIX version of "\\frac", which we don't want):
//}
//if (st=="-" && AMpreviousSymbol==INFIX) {
//  AMcurrentSymbol = INFIX;  //trick "/" into recognizing "-" on second parse
//  return {input:st, tag:tagst, output:st, ttype:UNARY, func:true};
//}
*/
  return {input:st, tag:tagst, output:st, ttype:CONST};
}


/*Parsing ASCII math expressions with the following grammar
v ::= [A-Za-z] | greek letters | numbers | other constant symbols
u ::= sqrt | text | bb | other unary symbols for font commands
b ::= frac | root | stackrel	binary symbols
l ::= { | \left			left brackets
r ::= } | \right		right brackets
S ::= v | lEr | uS | bSS	Simple expression
I ::= S_S | S^S | S_S^S | S	Intermediate expression
E ::= IE | I/I			Expression
Each terminal symbol is translated into a corresponding mathml node.*/

var AMpreviousSymbol,AMcurrentSymbol;

function AMparseSexpr(str) { //parses str and returns [node,tailstr,(node)tag]
  var symbol, node, result, result2, i, st,// rightvert = false,
    newFrag = document.createDocumentFragment();
  str = AMremoveCharsAndBlanks(str,0);
  symbol = AMgetSymbol(str);             //either a token or a bracket or empty
  if (symbol == null || symbol.ttype == RIGHTBRACKET)
    return [null,str,null];
  if (symbol.ttype == DEFINITION) {
    str = symbol.output+AMremoveCharsAndBlanks(str,symbol.input.length);
    symbol = AMgetSymbol(str);
    if (symbol == null || symbol.ttype == RIGHTBRACKET)
      return [null,str,null];
  }
  str = AMremoveCharsAndBlanks(str,symbol.input.length);
  switch (symbol.ttype) {
  case SPACE:
    node = AMcreateElementMathML(symbol.tag);
    node.setAttribute(symbol.atname,symbol.atval);
    return [node,str,symbol.tag];
  case UNDEROVER:
    if (isIE) {
      if (symbol.input.substr(0,4) == "\\big") {   // botch for missing symbols
	str = "\\"+symbol.input.substr(4)+str;	   // make \bigcup = \cup etc.
	symbol = AMgetSymbol(str);
	symbol.ttype = UNDEROVER;
	str = AMremoveCharsAndBlanks(str,symbol.input.length);
      }
    }
    return [AMcreateMmlNode(symbol.tag,
			document.createTextNode(symbol.output)),str,symbol.tag];
  case CONST:
    var output = symbol.output;
    if (isIE) {
      if (symbol.input == "'")
	output = "\u2032";
      else if (symbol.input == "''")
	output = "\u2033";
      else if (symbol.input == "'''")
	output = "\u2033\u2032";
      else if (symbol.input == "''''")
	output = "\u2033\u2033";
      else if (symbol.input == "\\square")
	output = "\u25A1";	// same as \Box
      else if (symbol.input.substr(0,5) == "\\frac") {
						// botch for missing fractions
	var denom = symbol.input.substr(6,1);
	if (denom == "5" || denom == "6") {
	  str = symbol.input.replace(/\\frac/,"\\frac ")+str;
	  return [node,str,symbol.tag];
	}
      }
    }
    node = AMcreateMmlNode(symbol.tag,document.createTextNode(output));
    return [node,str,symbol.tag];
  case LONG:  // added by DRW
    node = AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output));
    node.setAttribute("minsize","1.5");
    node.setAttribute("maxsize","1.5");
    node = AMcreateMmlNode("mover",node);
    node.appendChild(AMcreateElementMathML("mspace"));
    return [node,str,symbol.tag];
  case STRETCHY:  // added by DRW
    if (isIE && symbol.input == "\\backslash")
	symbol.output = "\\";	// doesn't expand, but then nor does "\u2216"
    node = AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output));
    if (symbol.input == "|" || symbol.input == "\\vert" ||
	symbol.input == "\\|" || symbol.input == "\\Vert") {
	  node.setAttribute("lspace","0em");
	  node.setAttribute("rspace","0em");
    }
    node.setAttribute("maxsize",symbol.atval);  // don't allow to stretch here
    if (symbol.rtag != null)
      return [node,str,symbol.rtag];
    else
      return [node,str,symbol.tag];
  case BIG:  // added by DRW
    var atval = symbol.atval;
    if (isIE)
      atval = symbol.ieval;
    symbol = AMgetSymbol(str);
    if (symbol == null)
	return [null,str,null];
    str = AMremoveCharsAndBlanks(str,symbol.input.length);
    node = AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output));
    if (isIE) {		// to get brackets to expand
      var space = AMcreateElementMathML("mspace");
      space.setAttribute("height",atval+"ex");
      node = AMcreateMmlNode("mrow",node);
      node.appendChild(space);
    } else {		// ignored in IE
      node.setAttribute("minsize",atval);
      node.setAttribute("maxsize",atval);
    }
    return [node,str,symbol.tag];
  case LEFTBRACKET:   //read (expr+)
    if (symbol.input == "\\left") { // left what?
      symbol = AMgetSymbol(str);
      if (symbol != null) {
	if (symbol.input == ".")
	  symbol.invisible = true;
	str = AMremoveCharsAndBlanks(str,symbol.input.length);
      }
    }
    result = AMparseExpr(str,true,false);
    if (symbol==null ||
	(typeof symbol.invisible == "boolean" && symbol.invisible))
      node = AMcreateMmlNode("mrow",result[0]);
    else {
      node = AMcreateMmlNode("mo",document.createTextNode(symbol.output));
      node = AMcreateMmlNode("mrow",node);
      node.appendChild(result[0]);
    }
    return [node,result[1],result[2]];
  case MATRIX:	 //read (expr+)
    if (symbol.input == "\\begin{array}") {
      var mask = "";
      symbol = AMgetSymbol(str);
      str = AMremoveCharsAndBlanks(str,0);
      if (symbol == null)
	mask = "l";
      else {
	str = AMremoveCharsAndBlanks(str,symbol.input.length);
	if (symbol.input != "{")
	  mask = "l";
	else do {
	  symbol = AMgetSymbol(str);
	  if (symbol != null) {
	    str = AMremoveCharsAndBlanks(str,symbol.input.length);
	    if (symbol.input != "}")
	      mask = mask+symbol.input;
	  }
	} while (symbol != null && symbol.input != "" && symbol.input != "}");
      }
      result = AMparseExpr("{"+str,true,true);
//    if (result[0]==null) return [AMcreateMmlNode("mo",
//			   document.createTextNode(symbol.input)),str];
      node = AMcreateMmlNode("mtable",result[0]);
      mask = mask.replace(/l/g,"left ");
      mask = mask.replace(/r/g,"right ");
      mask = mask.replace(/c/g,"center ");
      node.setAttribute("columnalign",mask);
      node.setAttribute("displaystyle","false");
      if (isIE)
	return [node,result[1],null];
// trying to get a *little* bit of space around the array
// (IE already includes it)
      var lspace = AMcreateElementMathML("mspace");
      lspace.setAttribute("width","0.167em");
      var rspace = AMcreateElementMathML("mspace");
      rspace.setAttribute("width","0.167em");
      var node1 = AMcreateMmlNode("mrow",lspace);
      node1.appendChild(node);
      node1.appendChild(rspace);
      return [node1,result[1],null];
    } else {	// eqnarray
      result = AMparseExpr("{"+str,true,true);
      node = AMcreateMmlNode("mtable",result[0]);
      if (isIE)
	node.setAttribute("columnspacing","0.25em"); // best in practice?
      else
	node.setAttribute("columnspacing","0.167em"); // correct (but ignored?)
      node.setAttribute("columnalign","right center left");
      node.setAttribute("displaystyle","true");
      node = AMcreateMmlNode("mrow",node);
      return [node,result[1],null];
    }
  case TEXT:
      if (str.charAt(0)=="{") i=str.indexOf("}");
      else i = 0;
      if (i==-1)
		 i = str.length;
      st = str.slice(1,i);
      if (st.charAt(0) == " ") {
	node = AMcreateElementMathML("mspace");
	node.setAttribute("width","0.33em");	// was 1ex
	newFrag.appendChild(node);
      }
      newFrag.appendChild(
        AMcreateMmlNode(symbol.tag,document.createTextNode(st)));
      if (st.charAt(st.length-1) == " ") {
	node = AMcreateElementMathML("mspace");
	node.setAttribute("width","0.33em");	// was 1ex
	newFrag.appendChild(node);
      }
      str = AMremoveCharsAndBlanks(str,i+1);
      return [AMcreateMmlNode("mrow",newFrag),str,null];
  case UNARY:
      result = AMparseSexpr(str);
      if (result[0]==null) return [AMcreateMmlNode(symbol.tag,
                             document.createTextNode(symbol.output)),str];
      if (typeof symbol.func == "boolean" && symbol.func) { // functions hack
	st = str.charAt(0);
//	if (st=="^" || st=="_" || st=="/" || st=="|" || st==",") {
	if (st=="^" || st=="_" || st==",") {
	  return [AMcreateMmlNode(symbol.tag,
		    document.createTextNode(symbol.output)),str,symbol.tag];
        } else {
	  node = AMcreateMmlNode("mrow",
	   AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)));
	  if (isIE) {
	    var space = AMcreateElementMathML("mspace");
	    space.setAttribute("width","0.167em");
	    node.appendChild(space);
	  }
	  node.appendChild(result[0]);
	  return [node,result[1],symbol.tag];
        }
      }
      if (symbol.input == "\\sqrt") {		// sqrt
	if (isIE) {	// set minsize, for \surd
	  var space = AMcreateElementMathML("mspace");
	  space.setAttribute("height","1.2ex");
	  space.setAttribute("width","0em");	// probably no effect
	  node = AMcreateMmlNode(symbol.tag,result[0])
//	  node.setAttribute("minsize","1");	// ignored
//	  node = AMcreateMmlNode("mrow",node);  // hopefully unnecessary
	  node.appendChild(space);
	  return [node,result[1],symbol.tag];
	} else
	  return [AMcreateMmlNode(symbol.tag,result[0]),result[1],symbol.tag];
      } else if (typeof symbol.acc == "boolean" && symbol.acc) {   // accent
        node = AMcreateMmlNode(symbol.tag,result[0]);
	var output = symbol.output;
	if (isIE) {
		if (symbol.input == "\\hat")
			output = "\u0302";
		else if (symbol.input == "\\widehat")
			output = "\u005E";
		else if (symbol.input == "\\bar")
			output = "\u00AF";
		else if (symbol.input == "\\grave")
			output = "\u0300";
		else if (symbol.input == "\\tilde")
			output = "\u0303";
	}
	var node1 = AMcreateMmlNode("mo",document.createTextNode(output));
	if (symbol.input == "\\vec" || symbol.input == "\\check")
						// don't allow to stretch
	    node1.setAttribute("maxsize","1.2");
		 // why doesn't "1" work?  \vec nearly disappears in firefox
	if (isIE && symbol.input == "\\bar")
	    node1.setAttribute("maxsize","0.5");
	if (symbol.input == "\\underbrace" || symbol.input == "\\underline")
	  node1.setAttribute("accentunder","true");
	else
	  node1.setAttribute("accent","true");
	node.appendChild(node1);
	if (symbol.input == "\\overbrace" || symbol.input == "\\underbrace")
	  node.ttype = UNDEROVER;
	return [node,result[1],symbol.tag];
      } else {			      // font change or displaystyle command
        if (!isIE && typeof symbol.codes != "undefined") {
          for (i=0; i<result[0].childNodes.length; i++)
            if (result[0].childNodes[i].nodeName=="mi" || result[0].nodeName=="mi") {
              st = (result[0].nodeName=="mi"?result[0].firstChild.nodeValue:
                              result[0].childNodes[i].firstChild.nodeValue);
              var newst = [];
              for (var j=0; j<st.length; j++)
                if (st.charCodeAt(j)>64 && st.charCodeAt(j)<91) newst = newst +
                  String.fromCharCode(symbol.codes[st.charCodeAt(j)-65]);
                else newst = newst + st.charAt(j);
              if (result[0].nodeName=="mi")
                result[0]=AMcreateElementMathML("mo").
                          appendChild(document.createTextNode(newst));
              else result[0].replaceChild(AMcreateElementMathML("mo").
          appendChild(document.createTextNode(newst)),result[0].childNodes[i]);
            }
        }
        node = AMcreateMmlNode(symbol.tag,result[0]);
        node.setAttribute(symbol.atname,symbol.atval);
	if (symbol.input == "\\scriptstyle" ||
	    symbol.input == "\\scriptscriptstyle")
		node.setAttribute("displaystyle","false");
	return [node,result[1],symbol.tag];
      }
  case BINARY:
    result = AMparseSexpr(str);
    if (result[0]==null) return [AMcreateMmlNode("mo",
			   document.createTextNode(symbol.input)),str,null];
    result2 = AMparseSexpr(result[1]);
    if (result2[0]==null) return [AMcreateMmlNode("mo",
			   document.createTextNode(symbol.input)),str,null];
    if (symbol.input=="\\root" || symbol.input=="\\stackrel")
      newFrag.appendChild(result2[0]);
    newFrag.appendChild(result[0]);
    if (symbol.input=="\\frac") newFrag.appendChild(result2[0]);
    return [AMcreateMmlNode(symbol.tag,newFrag),result2[1],symbol.tag];
  case INFIX:
    str = AMremoveCharsAndBlanks(str,symbol.input.length);
    return [AMcreateMmlNode("mo",document.createTextNode(symbol.output)),
	str,symbol.tag];
  default:
    return [AMcreateMmlNode(symbol.tag,        //its a constant
	document.createTextNode(symbol.output)),str,symbol.tag];
  }
}

function AMparseIexpr(str) {
  var symbol, sym1, sym2, node, result, tag, underover;
  str = AMremoveCharsAndBlanks(str,0);
  sym1 = AMgetSymbol(str);
  result = AMparseSexpr(str);
  node = result[0];
  str = result[1];
  tag = result[2];
  symbol = AMgetSymbol(str);
  if (symbol.ttype == INFIX) {
    str = AMremoveCharsAndBlanks(str,symbol.input.length);
    result = AMparseSexpr(str);
    if (result[0] == null) // show box in place of missing argument
      result[0] = AMcreateMmlNode("mo",document.createTextNode("\u25A1"));
    str = result[1];
    tag = result[2];
    if (symbol.input == "_" || symbol.input == "^") {
      sym2 = AMgetSymbol(str);
      tag = null;	// no space between x^2 and a following sin, cos, etc.
// This is for \underbrace and \overbrace
      underover = ((sym1.ttype == UNDEROVER) || (node.ttype == UNDEROVER));
//    underover = (sym1.ttype == UNDEROVER);
      if (symbol.input == "_" && sym2.input == "^") {
        str = AMremoveCharsAndBlanks(str,sym2.input.length);
        var res2 = AMparseSexpr(str);
	str = res2[1];
	tag = res2[2];  // leave space between x_1^2 and a following sin etc.
        node = AMcreateMmlNode((underover?"munderover":"msubsup"),node);
        node.appendChild(result[0]);
        node.appendChild(res2[0]);
      } else if (symbol.input == "_") {
	node = AMcreateMmlNode((underover?"munder":"msub"),node);
        node.appendChild(result[0]);
      } else {
	node = AMcreateMmlNode((underover?"mover":"msup"),node);
        node.appendChild(result[0]);
      }
      node = AMcreateMmlNode("mrow",node); // so sum does not stretch
    } else {
      node = AMcreateMmlNode(symbol.tag,node);
      if (symbol.input == "\\atop" || symbol.input == "\\choose")
	node.setAttribute("linethickness","0ex");
      node.appendChild(result[0]);
      if (symbol.input == "\\choose")
	node = AMcreateMmlNode("mfenced",node);
    }
  }
  return [node,str,tag];
}

function AMparseExpr(str,rightbracket,matrix) {
  var symbol, node, result, i, tag,
  newFrag = document.createDocumentFragment();
  do {
    str = AMremoveCharsAndBlanks(str,0);
    result = AMparseIexpr(str);
    node = result[0];
    str = result[1];
    tag = result[2];
    symbol = AMgetSymbol(str);
    if (node!=undefined) {
      if ((tag == "mn" || tag == "mi") && symbol!=null &&
	typeof symbol.func == "boolean" && symbol.func) {
			// Add space before \sin in 2\sin x or x\sin x
	  var space = AMcreateElementMathML("mspace");
	  space.setAttribute("width","0.167em");
	  node = AMcreateMmlNode("mrow",node);
	  node.appendChild(space);
      }
      newFrag.appendChild(node);
    }
  } while ((symbol.ttype != RIGHTBRACKET)
        && symbol!=null && symbol.output!="");
  tag = null;
  if (symbol.ttype == RIGHTBRACKET) {
    if (symbol.input == "\\right") { // right what?
      str = AMremoveCharsAndBlanks(str,symbol.input.length);
      symbol = AMgetSymbol(str);
      if (symbol != null && symbol.input == ".")
	symbol.invisible = true;
      if (symbol != null)
	tag = symbol.rtag;
    }
    if (symbol!=null)
      str = AMremoveCharsAndBlanks(str,symbol.input.length); // ready to return
    var len = newFrag.childNodes.length;
    if (matrix &&
      len>0 && newFrag.childNodes[len-1].nodeName == "mrow" && len>1 &&
      newFrag.childNodes[len-2].nodeName == "mo" &&
      newFrag.childNodes[len-2].firstChild.nodeValue == "&") { //matrix
	var pos = []; // positions of ampersands
        var m = newFrag.childNodes.length;
        for (i=0; matrix && i<m; i=i+2) {
          pos[i] = [];
          node = newFrag.childNodes[i];
	  for (var j=0; j<node.childNodes.length; j++)
	    if (node.childNodes[j].firstChild.nodeValue=="&")
	      pos[i][pos[i].length]=j;
        }
	var row, frag, n, k, table = document.createDocumentFragment();
	for (i=0; i<m; i=i+2) {
	  row = document.createDocumentFragment();
	  frag = document.createDocumentFragment();
	  node = newFrag.firstChild; // <mrow> -&-&...&-&- </mrow>
	  n = node.childNodes.length;
	  k = 0;
	  for (j=0; j<n; j++) {
	    if (typeof pos[i][k] != "undefined" && j==pos[i][k]){
	      node.removeChild(node.firstChild); //remove &
	      row.appendChild(AMcreateMmlNode("mtd",frag));
	      k++;
	    } else frag.appendChild(node.firstChild);
	  }
	  row.appendChild(AMcreateMmlNode("mtd",frag));
	  if (newFrag.childNodes.length>2) {
	    newFrag.removeChild(newFrag.firstChild); //remove <mrow> </mrow>
	    newFrag.removeChild(newFrag.firstChild); //remove <mo>&</mo>
	  }
	  table.appendChild(AMcreateMmlNode("mtr",row));
	}
	return [table,str];
    }
    if (typeof symbol.invisible != "boolean" || !symbol.invisible) {
      node = AMcreateMmlNode("mo",document.createTextNode(symbol.output));
      newFrag.appendChild(node);
    }
  }
  return [newFrag,str,tag];
}

function AMparseMath(str) {
  var result, node = AMcreateElementMathML("mstyle");
  if (mathcolor != "") node.setAttribute("mathcolor",mathcolor);
  if (mathfontfamily != "") node.setAttribute("fontfamily",mathfontfamily);
  node.appendChild(AMparseExpr(str.replace(/^\s+/g,""),false,false)[0]);
  node = AMcreateMmlNode("math",node);
  if (showasciiformulaonhover)                      //fixed by djhsu so newline
    node.setAttribute("title",str.replace(/\s+/g," "));//does not show in Gecko
  if (mathfontfamily != "" && (isIE || mathfontfamily != "serif")) {
    var fnode = AMcreateElementXHTML("font");
    fnode.setAttribute("face",mathfontfamily);
    fnode.appendChild(node);
    return fnode;
  }
  return node;
}

function AMstrarr2docFrag(arr, linebreaks) {
  var newFrag=document.createDocumentFragment();
  var expr = false;
  for (var i=0; i<arr.length; i++) {
    if (expr) newFrag.appendChild(AMparseMath(arr[i]));
    else {
      var arri = (linebreaks ? arr[i].split("\n\n") : [arr[i]]);
      newFrag.appendChild(AMcreateElementXHTML("span").
      appendChild(document.createTextNode(arri[0])));
      for (var j=1; j<arri.length; j++) {
        newFrag.appendChild(AMcreateElementXHTML("p"));
        newFrag.appendChild(AMcreateElementXHTML("span").
        appendChild(document.createTextNode(arri[j])));
      }
    }
    expr = !expr;
  }
  return newFrag;
}

function AMprocessNodeR(n, linebreaks) {
  var mtch, str, arr, frg, i;
  if (n.childNodes.length == 0) {
   if ((n.nodeType!=8 || linebreaks) &&
    n.parentNode.nodeName!="form" && n.parentNode.nodeName!="FORM" &&
    n.parentNode.nodeName!="textarea" && n.parentNode.nodeName!="TEXTAREA" &&
    n.parentNode.nodeName!="pre" && n.parentNode.nodeName!="PRE") {
    str = n.nodeValue;
    if (!(str == null)) {
      str = str.replace(/\r\n\r\n/g,"\n\n");
      str = str.replace(/\x20+/g," ");
      str = str.replace(/\s*\r\n/g," ");
// DELIMITERS:
      mtch = (str.indexOf("\$")==-1 ? false : true);
      str = str.replace(/([^\\])\$/g,"$1 \$");
      str = str.replace(/^\$/," \$");	// in case \$ at start of string
      arr = str.split(" \$");
      for (i=0; i<arr.length; i++)
	arr[i]=arr[i].replace(/\\\$/g,"\$");
      if (arr.length>1 || mtch) {
        if (checkForMathML) {
          checkForMathML = false;
          var nd = AMisMathMLavailable();
          AMnoMathML = nd != null;
          if (AMnoMathML && notifyIfNoMathML)
            if (alertIfNoMathML)
              alert("To view the ASCIIMathML notation use Internet Explorer 6 +\nMathPlayer (free from www.dessci.com)\n\
                or Firefox/Mozilla/Netscape");
            else AMbody.insertBefore(nd,AMbody.childNodes[0]);
        }
        if (!AMnoMathML) {
          frg = AMstrarr2docFrag(arr,n.nodeType==8);
          var len = frg.childNodes.length;
          n.parentNode.replaceChild(frg,n);
          return len-1;
        } else return 0;
      }
    }
   } else return 0;
  } else if (n.nodeName!="math") {
    for (i=0; i<n.childNodes.length; i++)
      i += AMprocessNodeR(n.childNodes[i], linebreaks);
  }
  return 0;
}

function AMprocessNode(n, linebreaks, spanclassAM) {
  var frag,st;
  if (spanclassAM!=null) {
    frag = document.getElementsByTagName("span")
    for (var i=0;i<frag.length;i++)
      if (frag[i].className == "AM")
        AMprocessNodeR(frag[i],linebreaks);
  } else {
    try {
      st = n.innerHTML;
    } catch(err) {}
// DELIMITERS:
    if (st==null || st.indexOf("\$")!=-1)
      AMprocessNodeR(n,linebreaks);
  }
  if (isIE) { //needed to match size and font of formula to surrounding text
    frag = document.getElementsByTagName('math');
    for (var i=0;i<frag.length;i++) frag[i].update()
  }
}

var AMbody;
var AMnoMathML = false, AMtranslated = false;

function translate(spanclassAM) {
  if (!AMtranslated) { // run this only once
    AMtranslated = true;
    AMinitSymbols();
    AMbody = document.getElementsByTagName("body")[0];
    AMprocessNode(AMbody, false, spanclassAM);
  }
}

if (isIE) { // avoid adding MathPlayer info explicitly to each webpage
  document.write("<object id=\"mathplayer\"\
  classid=\"clsid:32F66A20-7614-11D4-BD11-00104BD3F987\"></object>");
  document.write("<?import namespace=\"m\" implementation=\"#mathplayer\"?>");
}

// GO1.1 Generic onload by Brothercake
// http://www.brothercake.com/
//onload function (replaces the onload="translate()" in the <body> tag)
function generic()
{
  translate();
};
//setup onload function
if(typeof window.addEventListener != 'undefined')
{
  //.. gecko, safari, konqueror and standard
  window.addEventListener('load', generic, false);
}
else if(typeof document.addEventListener != 'undefined')
{
  //.. opera 7
  document.addEventListener('load', generic, false);
}
else if(typeof window.attachEvent != 'undefined')
{
  //.. win/ie
  window.attachEvent('onload', generic);
}
//** remove this condition to degrade older browsers
else
{
  //.. mac/ie5 and anything else that gets this far
  //if there's an existing onload function
  if(typeof window.onload == 'function')
  {
    //store it
    var existing = onload;
    //add new onload handler
    window.onload = function()
    {
      //call existing onload function
      existing();
      //call generic onload function
      generic();
    };
  }
  else
  {
    //setup onload function
    window.onload = generic;
  }
}
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
<h1>BAnach Sequential Subspace Optimizer (BASSO)</h1>
<span id="author">Frederik Heber</span><br>
<span id="email" class="monospaced">&lt;<a href="mailto:frederik.heber@gmail.com">frederik.heber@gmail.com</a>&gt;</span><br>
<span id="revnumber">version 1.11.1,</span>
<span id="revdate">2019/04/10</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">2019/04/10 Basso: 1.11.1</div>
<div class="paragraph"><p>BASSO is a C++-library solving over-determined or under-determined linear
systems of equations in general Banach spaces. Its interface mimics the same
concepts in terms of classes and functions that are also needed for the
mathematical proof of convergence, namely spaces, norms, vectors, and (duality)
mappings. In other words, vectors are uniquely associated to a specific space
instance and calculating a scalar product of vectors from different spaces will
fail. This allowed a very robust method of implementing the sequential subspace
optimization methods that can be considered a generalization of the the
Conjugate Gradient Minimal Error method from Hilbert spaces to Banach spaces.
Overall, this provides a very efficient library to solve linear systems of
equations with general l_p regularization. Moreover, it also allows to
calculate low-rank matrix factorizations.</p></div>
<div class="paragraph"><p>BASSO received funding from the German Ministry for Research and Education
(BMBF) through the project HYPERMATH.</p></div>
<div class="paragraph"><p><em>Frederik Heber</em></p></div>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction.needtoknow">1.1. Before you start</h3>
<div class="paragraph"><p>In the following we assume that you, the reader, has a general
familiarity with optimization methods. You should be very well familiar with
linear systems of equations and be aware of issues when they are over- oder
under-determined, and the basics of inverse problems. You should know what a
Tikhonov-Philips functional is, how this can be solved numerically using the
Landweber method. You should be familiar with Hilbert spaces and know the
principal differences to more general Banach spaces.</p></div>
<div class="paragraph"><p>If you are <em>not</em> familiar with the above terminology, then we recommend an
introductory book to regularization methods such as <a href="#Schuster2012">[Schuster2012]</a>. However,
a small introduction is also given in <a href="#background">[background]</a>.</p></div>
<div class="paragraph"><p>If you are generally interested in the mathematical background of Banach spaces,
Bregman distances and so on, we recommend <a href="#Cioranescu1990">[Cioranescu1990]</a>.</p></div>
</div>
<div class="sect2">
<h3 id="introduction.whatis">1.2. What is BASSO?</h3>
<div class="paragraph"><p>BASSO is a library written in C++ to solve inverse problems in Banach spaces.
It is both an interface in C++ and in Python3.
Moreover, it comes with a bunch of tools that allow to address certain kind of
inverse problems, e.g. inverse problems of ill-conditioned matrices, matrix
factorization and certain specific <em>classical</em> inverse problems such as
Computerized Tomography. These also may serve as examples how to use the
library.</p></div>
<div class="paragraph"><p>We stress that the library&#8217;s interface is written from the viewpoint of the
mathematical objects encountered in this problem setup, i.e. there are classes
that model vector spaces, normed vector spaces and elements thereof. There are
mappings between spaces and functions working on elements from specific spaces.
In order to put these to their best use it is recommended to have a background
of the mathematical concepts involved.</p></div>
<div class="paragraph"><p>Therefore, it is not aimed at users who simply wish to call a function to solve
a certain type of inverse problem although it comes with a few helper programs
that might do the job. At its core it is a library that allows to solve an
inverse problem if ones possesses some knowledge of the mathematical
underpinning and wishes to see this at work. Extensive care has been taken such
that the library automatically prevents mishaps in the tool development such as
using vectors from the "wrong" space, use mappings in the wrong way, and so on.</p></div>
</div>
<div class="sect2">
<h3 id="introduction.installation">1.3. Installation</h3>
<div class="paragraph"><p>In the following we explain the installation procedure to get
BASSO up and running.</p></div>
<div class="sect3">
<h4 id="introduction.installation.requirements">1.3.1. Installation requirements</h4>
<div class="paragraph"><p>This program suite is implemented using C++ and Python3 and the
development mainly focused on Linux (development machine used Ubuntu 14.04 and
16.04). At the moment other operating systems are not supported but may still
work. Note that the build system depends on CMake which principally allows to
generate configuration files also for Integrated Developer Environments popular
on Windows.</p></div>
<div class="paragraph"><p>It has the following non-trivial dependencies:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://cmake.org/">CMake</a>
</p>
</li>
<li>
<p>
<a href="https://www.gnu.org/software/gsl/">GSL</a>
</p>
</li>
<li>
<p>
<a href="https://eigen.tuxfamily.org">Eigen</a>: version 3.2.8 or later
</p>
</li>
<li>
<p>
<a href="https://cppunit.sourceforge.net/">CppUnit</a>
</p>
</li>
<li>
<p>
<a href="http://boost.org/">boost</a>: version 1.61 or later
</p>
</li>
<li>
<p>
<a href="https://pocoproject.org/">poco</a>: optionally used for writing sqlite3<br>
database
</p>
</li>
</ul></div>
<div class="paragraph"><p>Note that these packages can be easily installed using either
the repository tool (using some linux distribution such as Ubuntu), e.g.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>sudo apt install cmake</pre>
</div></div>
<div class="paragraph"><p>Moreover, the following packages are not ultimately required but
examples or tests may depend on them:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.sqlite.org">sqlite3</a>
</p>
</li>
<li>
<p>
<a href="https://www.gnu.org/s/gawk/manual/gawk.html">gawk</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The documentation is written in <a href="https://asciidoc.org/">AsciiDoc</a> and
<a href="http://www.doxygen.nl/">doxygen</a> and requires a suitable package to compile
to HTML or create a PDF, e.g., using dblatex</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.doxygen.nl/">doxygen</a>
</p>
</li>
<li>
<p>
<a href="https://www.methods.co.nz/asciidoc/userguide.html">asciidoc</a>
</p>
</li>
<li>
<p>
<a href="http://dblatex.sourceforge.net/">dblatex</a>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="introduction.installation.procedure">1.3.2. Installation procedure</h4>
<div class="paragraph"><p>Installation comes in two flavors: either via a tarball or a cloned repository.</p></div>
<div class="paragraph"><p>The tarball releases are recommended if you only plan to use BASSO and do not
intend modifying its code. If, however, you need to use a development branch,
then you have to clone from the repository.</p></div>
<div class="paragraph"><p>In general, this package is compiled and installed via CMake. Please refer to
the text <span class="monospaced">README</span> file that is included in the tarball.</p></div>
</div>
<div class="sect3">
<h4 id="introduction.installation.procedure.tarball">1.3.3. From Tarball</h4>
<div class="paragraph"><p>Unpack the archive, assuming its suffix is <span class="monospaced">.gz</span>.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>tar -zxvf basso-${revnumber}.tar.gz</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="introduction.installation.repository">1.3.4. From cloned repository</h4>
<div class="paragraph"><p>In case you are cloning the repository,</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>git clone https://github.com/FrederikHeber/BASSO.git</pre>
</div></div>
<div class="paragraph"><p>then you are in the same position as having unpacked the release tarball.</p></div>
<div class="paragraph"><p>Enter the directory</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>cd basso</pre>
</div></div>
<div class="paragraph"><p>Continue then in section <a href="#configure_make_install">Configure, make, install</a>.</p></div>
</div>
<div class="sect3">
<h4 id="introduction.installation.configure_make_install">1.3.5. Configure, make, make install</h4>
<div class="paragraph"><p>Next, we recommend to build the toolkit not in the source folder but in an
extra folder, e.g., &#8220;build64&#8221;. This is called an <em>out-of-source</em> build. It
prevents cluttering of the source folder. Naturally, you may pick any name
(and actually any location on your computer) as you see fit.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>mkdir build64
cd build64
cmake ..
make
make install</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph"><p>There are many options to control <span class="monospaced">cmake</span>, e.g. giving a prefix to set the
installation location, directing to unusually installed boost or eigen
versions, and many more.</p></div>
<div class="paragraph"><p>For more details on these options with <span class="monospaced">cmake</span> please take a look at the
up-to-date README` file</p></div>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>We recommend executing (after <span class="monospaced">make install</span> was run)</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>make -j4 test</pre>
</div></div>
<div class="paragraph"><p>additionally. This will execute every test on the extensive testsuite
and report any errors. None should fail. If all fail, a possible cause
might be a not working tensorflow installation. If some fail, please
contact the author.
The extra argument <strong>-j4</strong> instructs <span class="monospaced">make</span> to use four threads in parallel for
testing. Use as many as you have cores on your machine.</p></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="introduction.license">1.4. License</h3>
<div class="paragraph"><p>As long as no other license statement is given,
ThermodynamicAnalyticsToolkit is free for use under the GNU Public
License (GPL) Version 2 (see <a href="https://www.gnu.org/licenses/gpl-2.0.en.html">https://www.gnu.org/licenses/gpl-2.0.en.html</a> for
full text).</p></div>
</div>
<div class="sect2">
<h3 id="introduction.disclaimer">1.5. Disclaimer</h3>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>Because the program is licensed free of charge, there is not warranty
for the program, to the extent permitted by applicable law. Except when
otherwise stated in writing in the copyright holders and/or other
parties provide the program "as is" without warranty of any kind, either
expressed or implied. Including, but not limited to, the implied
warranties of merchantability and fitness for a particular purpose. The
entire risk as to the quality and performance of the program is with
you. Should the program prove defective, you assume the cost of all
necessary servicing, repair, or correction.</p></div>
</div>
<div class="attribution">
<em>https://www.gnu.org/licenses/gpl-2.0.en.html</em><br>
&#8212; section 11 of the GPLv2 license
</div></div>
</div>
<div class="sect2">
<h3 id="introduction.feedback">1.6. Feedback</h3>
<div class="paragraph"><p>If you encounter any bugs, errors, or would like to submit feature request,
please open an issue at <a href="https://github.com/FrederikHeber/BASSO">GitHub</a> or write to <a href="mailto:">frederik.heber@gmail.com</a>.
The authors are especially thankful for any description of all related events
prior to occurrence of the error and auxiliary files. More explicitly, the
<strong>following information is crucial</strong> in enabling assistance:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>operating system</strong> and version, e.g., Ubuntu 16.04
</p>
</li>
<li>
<p>
<strong>BASSO version</strong> (or respective branch on GitHub), e.g., BASSO 1.10
</p>
</li>
<li>
<p>
steps that lead to the error, possibly with <strong>sample C++/Python code</strong>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Please mind sensible space restrictions of email attachments.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="background">2. Background</h2>
<div class="sectionbody">
<div class="paragraph"><p>One of the most ubiquitous tasks in computing is solving linear systems of
equations,
$A x = y$
where a matrix $A$ and a right-hand side vector $y$ are
given and we are looking for the solution vector $x$. Because of the
omnipresence of this problem, many different solution methods exist, whose
applicability depends on the properties of the matrix: when the matrix is
symmetric, one might use Cholesky factorization. If the matrix is symmetric and
positive definite, and especially if it is very large, Conjugate Gradient
schemes are typically employed.</p></div>
<div class="paragraph"><p>If the matrix is generic, e.g., it is not symmetric, then more general schemes
are necessary.</p></div>
<div class="paragraph"><p>From a more mathematical perspective, $x$ is the element of a vector
space $\mathrm{X}$. Moreover, the matrix is a linear operator
mapping between this space $\mathrm{X}$ and and itself or maybe
even another space $\mathrm{Y}$ that contains the given right-hand
side $y$.</p></div>
<div class="paragraph"><p>We are looking at the more interesting cases, where there is either no solution
$x$ or infinitely many, i.e., the system is over- oder
under-determined with a non-unique solution. Then, in order to define a
"closest" solution in the sense $||Ax-y||$, we need norms that
induce a metric. Therefore, the vector spaces are normed vector spaces.</p></div>
<div class="paragraph"><p>When the row and column dimensions are not the same, then we certainly do not
have a single space, but two spaces. This is also the case when different norms
apply to source and target space. Moreover, when the norm is not an
$\ell_2$-norm, then $\mathrm{X}$ is not even a Hilbert
space.</p></div>
<div class="paragraph"><p>With an under-determined or over-determined system of equation the linear
operator is in general not invertible. The remedy is called regularization where
the linear operator is modified in such a way as to become invertible but still
as faithful as possible to its original version. More generally, regularization
is required if the right-hand side is not in the range of the operator. This may
also occur for the case of "noisy data", i.e., when the right-hand side
$\widetilde{y} = y + \delta y$ is perturbed by white-noise
$\delta y$.</p></div>
<div class="paragraph"><p>Typically, (Tikhonov-)regularization is formulated as a minimization problem of
a functional $F(x)$ by adding a penalty term as follows:</p></div>
<div class="paragraph"><p>$min_x ( || Ax-y ||^2 + \lambda ||x||^2) =: min_x F(x)$.</p></div>
<div class="paragraph"><p>This minimization problems contains two terms: the first is called the data
fidelity term that minimizes the residual, i.e. the metric distance to the sets
of admissible solutions. The second term is the regularization term that
enforces a minimum-norm solution.</p></div>
<div class="paragraph"><p>Through the minimum norm requirement a solution can be sought that is equipped
with certain favorable properties. For example, a sparse solution is obtained
of the $\ell_1$-norm is used.</p></div>
<div class="paragraph"><p>As already mentioned, depending on the employed norms in this minimization
problem, the solutions no longer live in a Hilbert space but in a more general
Banach space, e.g., the N-dimensional vector space $\mathrm{R}^N$
equipped with the norm \ell_{1.1} norm.  Convergence theoretical
results are well-established for Hilbert spaces. For Banach spaces the situation
is more difficult: In a Banach space the space and its dual do not in general
coincide, namely they are not in general isometric isomorphic to each other.</p></div>
<div class="paragraph"><p>This in turn causes us to deal not with two spaces, $\mathrm{X}$
and $\mathrm{Y}$, but with possibly up to four spaces,
$\mathrm{X}$, $\mathrm{X}^\ast$, $\mathrm{Y}$,
and $\mathrm{Y}^\ast$.</p></div>
<div class="paragraph"><p>What is the relation between those spaces? Let us give a figure of the mappings.</p></div>
<div class="imageblock">
<div class="content">
<img src="./doc/images/FourSpaces.png" alt="Figure of the four involved Banach spaces and mappings between them" width="600">
</div>
</div>
<div class="paragraph"><p>The matrix $A$ and its dual mapping $A^\ast$, which in
finite dimensions is simply the complex conjugate, are obvious. However, what
are $J_p$ and so forth?</p></div>
<div class="paragraph"><p>The residual $Ax-y$ gives us the natural direction of error as the
only information we have about the true solution $x$ is given in the
mapped form as the right-hand side $y$. Therefore, we need a mapping
that preserves angles and lengths with respect to the norm of the respective
space. This role is fulfilled by the so-called duality mappings</p></div>
<div class="paragraph"><p>$J_p = { x^\ast \in \mathrm{X}^\ast | &lt;x^\ast, x&gt; = ||x||^p_{\mathrm{X}}, ||x^\ast|| = ||x||^{p-1} }$,</p></div>
<div class="paragraph"><p>where p is associated with the gauge function $t \rightarrow t^{p-1}$.<span class="footnote"><br>[In lp-spaces these two p coincide.]<br></span></p></div>
<div class="paragraph"><p>These are connected to the (sub-)gradient of the norm through the famous theorem
of Asplund, $J_p(x) = \frac{\partial}{\partial x} ( \frac 1 p ||x||^p)$</p></div>
<div class="paragraph"><p>A sub-gradient is a generalization of the gradient where the space is no longer
smooth and therefore the gradient is no longer unique.</p></div>
<div class="paragraph"><p>As last but one ingredient we need a new distance measure, replacing the metric
distance that has failed so far in allowing a proof of convergence. We use the
Bregman distance,</p></div>
<div class="paragraph"><p>$\Delta(x,y) = \tfrac 1 {p^\ast} ||x||^p - &lt; J_p (x), y &gt; + \frac 1 p || y ||^p$</p></div>
<div class="paragraph"><p>Finally, we seek for iterative solutions for the above minimization functional,
i.e., we have a procedure $x_{n+1} = x_n + f(x_n, \Delta F(x_n))$,
where the current iterature $x_n$ and the gradient of the functional
to be minimized $F(x_n)$, see above, are used to obtain the next
iterate $x_{n+1}$.</p></div>
<div class="paragraph"><p>In case of noisy right-hand sides, when no exact solution exists, the iteration
with respect to the minimization functional shows a typical behavior (assuming
we start with the origin as the first iterate): The
data fidelity term decreases and the minimum-norm term increases. There is a
cross-over point where the sum of the two no longer decrease but increases
because the minimum-norm term dominates. This gives rise to a so-called <strong>"L"-
shape</strong> and requires a stopping rule for the minimization as the optimal solution
lies at the kink of the L. This is called <strong>semi-convergence</strong>.</p></div>
<div class="paragraph"><p>All of this can be found in the following nice-to-read academical papers:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="#Schoepfer2006">[Schoepfer2006</a>]
</p>
<div class="paragraph"><p>First paper on a non-linear Landweber method using Duality Mappings for general
smooth, convex Banach spaces. Proof of strong convergence in noise-free case.</p></div>
</li>
<li>
<p>
<a href="#Schoepfer2008">[Schoepfer2008</a>]
</p>
<div class="paragraph"><p>Paper on the underlying relation between Metric and Bregman projections that
form the essential basis for the Sequential Subspace Methods. Multiple search
directions. Proof of weak convergence.</p></div>
</li>
<li>
<p>
<a href="#Schoepfer2009">[Schoepfer2009</a>]
</p>
<div class="paragraph"><p>Extension to perturbed right-hand sides. Proof of strong convergence for
specific set of multiple search directions. Fast method when using two search
directions by projection onto hyperplanes.</p></div>
</li>
<li>
<p>
<a href="#Heber2019">[Heber2019</a>] (also available as arXiv preprint <a href="#Heber2016">[Heber2016</a>]).
</p>
<div class="paragraph"><p>Acceleration of the Sequential Subspace Methods by using metric projections to orthogonalize search directions. Connection to Conjugate Gradient Minimal Error
method.</p></div>
</li>
</ul></div>
<div class="paragraph"><p>If you want to constrain yourself to a single paper, then we recommend the last
one as it formed the basis for this library.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="overview">3. Overview</h2>
<div class="sectionbody">
<div class="paragraph"><p>This mathematical introduction is necessary to understand the following elements
contained in this library and put them to the best possible use.</p></div>
<div class="paragraph"><p>Note that although the primary interface is written in C++, there is also
a Python 3 interface. However, in this section we only go over the primary
interface classes. The python interface is discussed in a separate <a href="#python">[python]</a>.</p></div>
<div class="sect2">
<h3 id="overview.basic_elements">3.1. The Basic Elements</h3>
<div class="paragraph"><p>BASSO mimics all of these objects we have introduced before in its class
structure:</p></div>
<div class="ulist"><ul>
<li>
<p>
(normed) vector space classes <span class="monospaced">NormedSpace</span> and <span class="monospaced">NormedDualSpace</span>,
</p>
</li>
<li>
<p>
norm class <span class="monospaced">L1Norm</span>, <span class="monospaced">LpNorm</span>, and <span class="monospaced">LInfinityNorm</span>,
</p>
</li>
<li>
<p>
vector class <span class="monospaced">SpaceElement</span>,
</p>
</li>
<li>
<p>
mapping classes <span class="monospaced">DualityMapping</span>&#8201;&#8212;&#8201;with specializations <span class="monospaced">LpDualityMapping</span>, <span class="monospaced">L1DualityMapping</span>, <span class="monospaced">LInfinityDualityMapping</span>&#8201;&#8212;&#8201;<span class="monospaced">LinearMapping</span> (for matrices), and
<span class="monospaced">TwoFactorLinearMapping</span> (for product of two matrices used in factorization
problems),
</p>
</li>
<li>
<p>
function(al) classes/functors such as <span class="monospaced">BregmanDistance</span>, <span class="monospaced">ResidualFunctional</span>, <span class="monospaced">SmoothnessFunctional</span>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>These can be considered the basic elements.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>BASSO is based on the well-known <a href="http://eigen.tuxfamily.org/">Eigen</a> library
for all linear algebra-relates routines. Therefore it uses the Eigen classes
<span class="monospaced">Eigen::MatrixXd</span> and <span class="monospaced">Eigen::VectorXd</span> for representing vectors and matrices.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="overview.inverse_problem">3.2. Inverse problem and Solver classes</h3>
<div class="paragraph"><p>Moreover, it contains some more complex classes that comprise the linear system
of equations to be solved or the overall problem structure, <span class="monospaced">InverseProblem</span>.</p></div>
<div class="paragraph"><p>In order to solve this inverse problem of Ax=y we need solvers.
Their classes are called <span class="monospaced">LandweberMinimizer</span>, <span class="monospaced">SequentialSubspaceMinimizer</span> or
<span class="monospaced">SequentialSubspaceMinimizerNoise</span> (with additional noise in the right-hand side
taken into account).</p></div>
</div>
<div class="sect2">
<h3 id="overview.general_usage">3.3. General usage concepts</h3>
<div class="paragraph"><p>Specific instances of these classes, e.g., the <span class="monospaced">NormedSpace</span> class, are created
using the so-called <strong>Factory</strong> pattern by classes that typically share the same
name just with an added Factory, e.g., <span class="monospaced">NormedSpaceFactory</span>. These contain a
function <span class="monospaced">create()</span> that is called with certain parameters and returns a pointer
to the created instance.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph"><p>All these pointers are wrapped into <span class="monospaced">boost::shared_ptr</span> to prevent memory loss,
i.e. they deallocate automatically when the last reference to the pointer is no
longer held.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>All things associated to an object, e.g., the norm of a space, can be queried
from an instance using <strong>getters</strong>, e.g.,  <span class="monospaced">NomedSpace.getNorm()</span> for the norm,
<span class="monospaced">NormedSpace.getDimension()</span> for the number of degrees of freedom of this space,
or <span class="monospaced">NormedSpace.getDualSpace()</span> for its dual space. See <a href="#reference.NormedSpace">[reference.NormedSpace]</a>
for details.</p></div>
</div>
<div class="sect2">
<h3 id="overview.inverse_problem_solving">3.4. Rough sketch of inverse problem solving</h3>
<div class="paragraph"><p>The following should give you a rough idea of how to solve an inverse problem</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Create the two Banach spaces as <span class="monospaced">NormedSpace</span> by supplying the respective lp
norm parameter. Their dual spaces are created automatically and so are in turn
the required duality mappings.
</p>
</li>
<li>
<p>
Create the right-hand side y as a <span class="monospaced">SpaceElement</span> by using <span class="monospaced">NormedSpace.createElement()</span> or <span class="monospaced">ElementCreator.create()</span> giving the
associated space and the <a href="http://eigen.tuxfamiliy.org">Eigen</a> vector.
</p>
</li>
<li>
<p>
Create the linear mapping A using <span class="monospaced">LinearMappingFactory.createInstance()</span> giving the two spaces and the <a href="http://eigen.tuxfamiliy.org">Eigen</a> matrix.
</p>
</li>
<li>
<p>
Create the inverse problem <span class="monospaced">InverseProblem</span> giving the mapping, the two
spaces and the right-hand side.
</p>
</li>
<li>
<p>
Create sensible starting values in the solution space and its dual. Note
that zero is always an admissible starting value.
</p>
</li>
<li>
<p>
Finally, instantiate a solver such as <span class="monospaced">SequentialSubspaceMinimizer</span> give it
the inverse problem, starting value and dual starting value and a true solution
if known.
</p>
</li>
</ol></div>
<div class="paragraph"><p>The result will be a structure wherein the approximate solution and a few other
instances such as the residual or the number of iterations and the status are contained.</p></div>
<div class="paragraph"><p>The first four steps can be combined using <span class="monospaced">InverseProblemFactory</span> that takes
certain string arguments describing the spaces and the right-hand side and the
matrix in <a href="http://eigen.tuxfamily.org">Eigen</a>-format.</p></div>
<div class="paragraph"><p>This is the approach used in the <span class="monospaced">Basso</span> tool that ships with this library,
see <a href="#examples.basso">[examples.basso]</a></p></div>
</div>
<div class="sect2">
<h3 id="overview_auxiliary_constraints">3.5. Inverse Problems with auxiliary constraints</h3>
<div class="paragraph"><p>For more complex problems a <strong>split feasibility</strong> ansatz is used where each
constraint is fulfilled in turn in an iterative fashion. In other words, there
are two iterations: An inner loop where the inverse problem is solved and an
outer loop where the different parts of the split feasibility problem&#8201;&#8212;&#8201;the
inverse problem is one of them&#8201;&#8212;&#8201;are minimized in turn.</p></div>
<div class="paragraph"><p>To this end, there is the abstract <span class="monospaced">FeasibilityProblem</span> class, the
<span class="monospaced">AuxiliaryConstraintsProblem</span> which combines it with an arbitrary combination of
<span class="monospaced">AuxiliaryConstraints</span> such as unity, non-negativity or a logical combination of
these. Finally, there is the high-level class <span class="monospaced">SplitFeasibilitySolver</span> that
solves inverse problems with these additional auxiliary constraints. These
constraints are simply `register()`ed with this class. See
<a href="#reference.solvers.SplitFeasibilitySolver">[reference.solvers.SplitFeasibilitySolver]</a> for details.</p></div>
<div class="paragraph"><p>Let us now  look at an example where we solve the random matrix toy problem.
We create a random matrix and a random right-hand side. We make sure that the
right-hand side is actually in the range of the matrix. We construct all
instances necessary for the solver and finally solve the inverse problem.</p></div>
<div class="paragraph"><p>We look at two versions: First, we inspect the "long" version where most of
the ingredients are set up by hand. There you will see all of the basic elements
that we talked about before. In the second "short" version we will use
a lot of convenience objects.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>We hide away all includes and two static functions for creating a random vector
and a random matrix in the include files <strong>random_matrix_inverseproblem_?.hpp</strong></p></div>
</td>
</tr></table>
</div>
<div class="listingblock">
<div class="title">Inverse Problem: Random matrix, longer version</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"random_matrix_inverseproblem_1.hpp"</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">int</span> innerSize <span style="color: #990000">=</span> <span style="color: #993399">500</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">int</span> outerSize <span style="color: #990000">=</span> <span style="color: #993399">100</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Eigen<span style="color: #990000">::</span><span style="color: #008080">MatrixXd</span> matrix <span style="color: #990000">=</span>
                <span style="font-weight: bold"><span style="color: #000000">getRandomMatrix</span></span><span style="color: #990000">(</span>outerSize<span style="color: #990000">,</span>innerSize<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Eigen<span style="color: #990000">::</span><span style="color: #008080">VectorXd</span> rhs <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getRandomVector</span></span><span style="color: #990000">(</span>outerSize<span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// place value of p and value of power type into boost any list</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// these define the lp norm and its duality mapping</span></span>
        InverseProblemFactory<span style="color: #990000">::</span><span style="color: #008080">args_t</span> args_SpaceX<span style="color: #990000">;</span>
        InverseProblemFactory<span style="color: #990000">::</span><span style="color: #008080">args_t</span> args_SpaceY<span style="color: #990000">;</span>
        args_SpaceX <span style="color: #990000">+=</span> boost<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">any</span></span><span style="color: #990000">(</span><span style="color: #993399">1.1</span><span style="color: #990000">),</span> boost<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">any</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">.);</span>
        args_SpaceY <span style="color: #990000">+=</span> boost<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">any</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">.),</span> boost<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">any</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">.);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// first, create the spaces X and Y</span></span>
        <span style="color: #008080">NormedSpace_ptr_t</span> X <span style="color: #990000">=</span> NormedSpaceFactory<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">create</span></span><span style="color: #990000">(</span>
                innerSize<span style="color: #990000">,</span> <span style="color: #FF0000">"lp"</span><span style="color: #990000">,</span> args_SpaceX<span style="color: #990000">);</span>
        <span style="color: #008080">NormedSpace_ptr_t</span> Y <span style="color: #990000">=</span> NormedSpaceFactory<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">create</span></span><span style="color: #990000">(</span>
                outerSize<span style="color: #990000">,</span> <span style="color: #FF0000">"lp"</span><span style="color: #990000">,</span> args_SpaceY<span style="color: #990000">);</span>
        <span style="font-style: italic"><span style="color: #9A1900">// Their dual spaces and mappings are created automatically</span></span>

        <span style="font-style: italic"><span style="color: #9A1900">// then create the right-hand side in the space Y</span></span>
        <span style="color: #008080">SpaceElement_ptr_t</span> y <span style="color: #990000">=</span> ElementCreator<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">create</span></span><span style="color: #990000">(</span>Y<span style="color: #990000">,</span> rhs<span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// and the LinearMapping A: X -&gt; Y</span></span>
        <span style="color: #008080">Mapping_ptr_t</span> A <span style="color: #990000">=</span>
                MappingFactory<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">createInstance</span></span><span style="color: #990000">(</span>X<span style="color: #990000">,</span>Y<span style="color: #990000">,</span> matrix<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// finally combine into an inverse problem instance: Ax = y</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">InverseProblem_ptr_t</span> <span style="font-weight: bold"><span style="color: #000000">inverseproblem</span></span><span style="color: #990000">(</span>
                        <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">InverseProblem</span></span><span style="color: #990000">(</span>A<span style="color: #990000">,</span>X<span style="color: #990000">,</span>Y<span style="color: #990000">,</span>y<span style="color: #990000">)</span> <span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// create options for the solver</span></span>
        <span style="color: #008080">CommandLineOptions</span> opts<span style="color: #990000">;</span>
        <span style="font-style: italic"><span style="color: #9A1900">// use orthogonalized search directions for faster convergence</span></span>
        opts<span style="color: #990000">.</span>orthogonalization_type <span style="color: #990000">=</span>
                LastNSearchDirections<span style="color: #990000">::</span>MetricOrthogonalization<span style="color: #990000">;</span>
        <span style="font-style: italic"><span style="color: #9A1900">// set values for the stopping conditions</span></span>
        opts<span style="color: #990000">.</span>delta <span style="color: #990000">=</span> <span style="color: #993399">1e-4</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* default value */</span></span>
        opts<span style="color: #990000">.</span>maxiter <span style="color: #990000">=</span> <span style="color: #993399">50</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* default value */</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// stop when max iterations (maxiter) are exceeded or</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// relative residum change is less than threshold (delta)</span></span>
        opts<span style="color: #990000">.</span>stopping_criteria <span style="color: #990000">=</span>
                <span style="color: #FF0000">"MaxIterationCount || RelativeResiduum"</span><span style="color: #990000">;</span>
        opts<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setVerbosity</span></span><span style="color: #990000">();</span>
        opts<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setSecondaryValues</span></span><span style="color: #990000">();</span>

        <span style="font-style: italic"><span style="color: #9A1900">// create a dummy database (which takes all iteration-related</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// information such as timings, number of various function</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// calls, ...) but does not store them unless we use</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// its setDatabaseFile()</span></span>
        <span style="color: #008080">Database_ptr_t</span> <span style="font-weight: bold"><span style="color: #000000">database</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">SQLDatabase</span></span><span style="color: #990000">());</span>

        <span style="font-style: italic"><span style="color: #9A1900">// create minimizer/solver SESOP with one direction</span></span>
        <span style="color: #008080">SequentialSubspaceMinimizer</span> <span style="color: #990000">*</span>solver <span style="color: #990000">=</span>
                <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">SequentialSubspaceMinimizer</span></span><span style="color: #990000">(</span>
                        opts<span style="color: #990000">,</span> inverseproblem<span style="color: #990000">,</span> <span style="color: #990000">*</span>database<span style="color: #990000">);</span>
        solver<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">setN</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// create starting point as zero in X</span></span>
        <span style="color: #008080">SpaceElement_ptr_t</span> solution_start <span style="color: #990000">=</span> X<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">createElement</span></span><span style="color: #990000">();</span>
        <span style="color: #008080">SpaceElement_ptr_t</span> zero <span style="color: #990000">=</span> X<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">createElement</span></span><span style="color: #990000">();</span>

        <span style="font-style: italic"><span style="color: #9A1900">// create dual starting point as zero in X^\ast</span></span>
        <span style="color: #008080">SpaceElement_ptr_t</span> dual_start <span style="color: #990000">=</span>
                X<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getDualSpace</span></span><span style="color: #990000">()-&gt;</span><span style="font-weight: bold"><span style="color: #000000">createElement</span></span><span style="color: #990000">();</span>

        <span style="font-style: italic"><span style="color: #9A1900">// solve Ax=y using SESOP</span></span>
        GeneralMinimizer<span style="color: #990000">::</span><span style="color: #008080">ReturnValues</span> result <span style="color: #990000">=</span> <span style="color: #990000">(*</span>solver<span style="color: #990000">)(</span>
                inverseproblem<span style="color: #990000">,</span>
                solution_start<span style="color: #990000">,</span>
                dual_start<span style="color: #990000">,</span>
                zero <span style="font-style: italic"><span style="color: #9A1900">/* states that true solution _not_ known */</span></span><span style="color: #990000">);</span>
        <span style="font-style: italic"><span style="color: #9A1900">// if true solution were known, Bregmn distance is calculated</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// and therein convergence can be observed.</span></span>

        <span style="font-style: italic"><span style="color: #9A1900">// check whether solving was successful</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>result<span style="color: #990000">.</span>status <span style="color: #990000">==</span> GeneralMinimizer<span style="color: #990000">::</span>ReturnValues<span style="color: #990000">::</span>error<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #000000">LOG</span></span><span style="color: #990000">(</span>error<span style="color: #990000">,</span> <span style="color: #FF0000">"Something went wrong during minimization."</span><span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>

        <span style="font-style: italic"><span style="color: #9A1900">// print iterations and remaining residual</span></span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Solution after "</span> <span style="color: #990000">&lt;&lt;</span> result<span style="color: #990000">.</span>NumberOuterIterations
                <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">" with relative residual of "</span>
                <span style="color: #990000">&lt;&lt;</span> result<span style="color: #990000">.</span>residuum<span style="color: #990000">/</span>inverseproblem<span style="color: #990000">-&gt;</span>y<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">Norm</span></span><span style="color: #990000">()</span>
                <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>As you probably notice, BASSO is at the moment focused on providing small
executables that solve specific (inverse) problems: We have set the options in
quite a crude fashion. It is much more elegant to query them from the user and
parse them from <span class="monospaced">(argc, argv)</span>. Above we have tried to rely on them as little as
possible.</p></div>
<div class="paragraph"><p>Let us look again at the above example. This time we create a
<span class="monospaced">CommandLineOptions</span> at the start and use all the convenience objects there are.</p></div>
<div class="listingblock">
<div class="title">Inverse Problem: Random matrix, short version</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"random_matrix_inverseproblem_2.hpp"</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">int</span> innerSize <span style="color: #990000">=</span> <span style="color: #993399">500</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">int</span> outerSize <span style="color: #990000">=</span> <span style="color: #993399">100</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Eigen<span style="color: #990000">::</span><span style="color: #008080">MatrixXd</span> matrix <span style="color: #990000">=</span>
                <span style="font-weight: bold"><span style="color: #000000">getRandomMatrix</span></span><span style="color: #990000">(</span>outerSize<span style="color: #990000">,</span>innerSize<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> Eigen<span style="color: #990000">::</span><span style="color: #008080">VectorXd</span> rhs <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getRandomVector</span></span><span style="color: #990000">(</span>outerSize<span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// create options for the solver</span></span>
        <span style="color: #008080">CommandLineOptions</span> opts<span style="color: #990000">;</span>
        opts<span style="color: #990000">.</span>algorithm_name <span style="color: #990000">=</span> <span style="color: #FF0000">"SESOP"</span><span style="color: #990000">;</span>
        opts<span style="color: #990000">.</span>delta <span style="color: #990000">=</span> <span style="color: #993399">1e-4</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* default value */</span></span>
        opts<span style="color: #990000">.</span>maxiter <span style="color: #990000">=</span> <span style="color: #993399">50</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* default value */</span></span>
        opts<span style="color: #990000">.</span>orthogonalization_type <span style="color: #990000">=</span>
                LastNSearchDirections<span style="color: #990000">::</span>MetricOrthogonalization<span style="color: #990000">;</span>
        opts<span style="color: #990000">.</span>px <span style="color: #990000">=</span> <span style="color: #993399">1.1</span><span style="color: #990000">;</span>
        opts<span style="color: #990000">.</span>py <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">.;</span> <span style="font-style: italic"><span style="color: #9A1900">/* already the default value */</span></span>
        opts<span style="color: #990000">.</span>powerx <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">.;</span> <span style="font-style: italic"><span style="color: #9A1900">/* already the default value */</span></span>
        opts<span style="color: #990000">.</span>powery <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">.;</span> <span style="font-style: italic"><span style="color: #9A1900">/* already the default value */</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// stop when max iterations are exceeded or relative residum</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// change is less than threshold</span></span>
        opts<span style="color: #990000">.</span>stopping_criteria <span style="color: #990000">=</span> <span style="color: #FF0000">"MaxIterationCount || RelativeResiduum"</span><span style="color: #990000">;</span>
        opts<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setVerbosity</span></span><span style="color: #990000">();</span>
        opts<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setSecondaryValues</span></span><span style="color: #990000">();</span>

        <span style="font-style: italic"><span style="color: #9A1900">// create a dummy database (which takes all iteration-related</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// information such as timings, number of various function</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// calls, ...) but does not store them unless we use</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// its setDatabaseFile()</span></span>
        <span style="color: #008080">Database_ptr_t</span> database <span style="color: #990000">=</span>
                SolverFactory<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">createDatabase</span></span><span style="color: #990000">(</span>opts<span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// prepare inverse problem</span></span>
        <span style="color: #008080">InverseProblem_ptr_t</span> inverseproblem <span style="color: #990000">=</span>
                SolverFactory<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">createInverseProblem</span></span><span style="color: #990000">(</span>
                        opts<span style="color: #990000">,</span> matrix<span style="color: #990000">,</span> rhs<span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// solving</span></span>
        <span style="color: #008080">InverseProblemSolver</span> <span style="font-weight: bold"><span style="color: #000000">solver</span></span><span style="color: #990000">(</span>
                inverseproblem<span style="color: #990000">,</span>
                database<span style="color: #990000">,</span>
                opts<span style="color: #990000">,</span>
                <span style="font-weight: bold"><span style="color: #0000FF">false</span></span> <span style="font-style: italic"><span style="color: #9A1900">/* true solution calculation */</span></span><span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// create starting point as zero in X</span></span>
        <span style="color: #008080">SpaceElement_ptr_t</span> solution_start <span style="color: #990000">=</span>
                inverseproblem<span style="color: #990000">-&gt;</span>x<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getSpace</span></span><span style="color: #990000">()-&gt;</span><span style="font-weight: bold"><span style="color: #000000">createElement</span></span><span style="color: #990000">();</span>

        <span style="font-style: italic"><span style="color: #9A1900">// solve Ax=y using SESOP</span></span>
        GeneralMinimizer<span style="color: #990000">::</span><span style="color: #008080">ReturnValues</span> result <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">solver</span></span><span style="color: #990000">(</span>
                solution_start <span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">// check whether solving was successful</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>result<span style="color: #990000">.</span>status <span style="color: #990000">==</span> GeneralMinimizer<span style="color: #990000">::</span>ReturnValues<span style="color: #990000">::</span>error<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #000000">LOG</span></span><span style="color: #990000">(</span>error<span style="color: #990000">,</span> <span style="color: #FF0000">"Something went wrong during minimization."</span><span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>

        <span style="font-style: italic"><span style="color: #9A1900">// print iterations and remaining residual</span></span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Solution after "</span> <span style="color: #990000">&lt;&lt;</span> result<span style="color: #990000">.</span>NumberOuterIterations
                <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">" with relative residual of "</span>
                <span style="color: #990000">&lt;&lt;</span> result<span style="color: #990000">.</span>residuum<span style="color: #990000">/</span>inverseproblem<span style="color: #990000">-&gt;</span>y<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">Norm</span></span><span style="color: #990000">()</span>
                <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>You see that all of the basic elements such as setting up of vector spaces and
mappings have disappeared. We can still access them through the getters of
any of their vectors, see the <span class="monospaced">InverseProblem</span> instance.</p></div>
<div class="paragraph"><p>These two listings give the basic structure of all example programs in this
library. In some cases we combine two minimizations, e.g., we might first
project onto the range of the matrix/operator, and then solve the inverse
problem without regularization.</p></div>
<div class="paragraph"><p>In the next section we look at some example programs that have been implemented
using the library. We will only discuss the general problem and how the
executable is called. Much of it is actually along the same lines as before.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="python">4. Python</h2>
<div class="sectionbody">
<div class="paragraph"><p>A Python 3 interface has been added to BASSO that allows to use the library
from a python program without any C++ knowledge.</p></div>
<div class="paragraph"><p>This is mainly accomplished through the <span class="monospaced">minieigen</span> package that allows to
construct compatible <span class="monospaced">Eigen::MatrixXd</span> and <span class="monospaced">Eigen::VectorXd</span> instances in python
from suitable <span class="monospaced">numpy</span> arrays.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content"><span class="monospaced">minieigen</span> has to be imported <strong>before</strong> the <span class="monospaced">pyBasso</span>
interface.</td>
</tr></table>
</div>
<div class="paragraph"><p>The principle paradigm for creating the Python interface (using <span class="monospaced">boost::python</span>)
was to convert the major C++ interface classes into Python classes  and
export <span class="monospaced">Factory::create()</span> by static functions. All getter functions have been
exported by simply making them (read-only) properties.</p></div>
<div class="paragraph"><p>In this part, assuming familiarity with the basic elements, we explain how to
use the Python interface.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>Naturally, there is extensive python <strong>docstring</strong> information available in the form</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> pyBasso
<span style="font-weight: bold"><span style="color: #000000">help</span></span><span style="color: #990000">(</span>pyBasso<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>that will produce a list of converted classes with their properties and member
functions and also the list of static functions. Each is accompanied with an
brief explanation.</p></div>
</td>
</tr></table>
</div>
<div class="sect2">
<h3 id="python.vectorspace">4.1. Vectors and spaces</h3>
<div class="paragraph"><p>Let us create a vector space and a vector x that is zero initially.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> pyBasso
<span style="font-weight: bold"><span style="color: #000080">import</span></span> numpy as np

X <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">create_LpSpace</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">.,</span> <span style="color: #993399">2</span><span style="color: #990000">.)</span>

x <span style="color: #990000">=</span> X<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createElement</span></span><span style="color: #990000">()</span>
x<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setZero</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p>The vector will have <strong>10</strong> components and we are using the <strong>$\ell_2$-norm</strong>
with a power type of <strong>2</strong>.</p></div>
<div class="paragraph"><p>The norm object can be accessed through <span class="monospaced">x.norm</span>, its space by <span class="monospaced">x.space</span> and
the dimension can then be obtained by <span class="monospaced">x.space.dim</span>. As mentioned, getters
simply are properties. The norm object can be used directly to obtain the norm
of <strong>x</strong>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>norm <span style="color: #990000">=</span> X<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getNorm</span></span><span style="color: #990000">()</span> <span style="font-style: italic"><span style="color: #9A1900"># implementing X.norm did not work</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">norm</span></span><span style="color: #990000">(</span>x<span style="color: #990000">))</span></tt></pre></div></div>
<div class="paragraph"><p>Predicates such as <span class="monospaced">SpaceElement::isZero()</span> are available as member functions
of the class, i.e., <span class="monospaced">x.isZero()</span>.</p></div>
</div>
<div class="sect2">
<h3 id="python.mappings">4.2. Mappings</h3>
<div class="paragraph"><p>For creating a LinearMapping, we need two spaces and a matrix.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># import minieigen before pyBasso!</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> minieigen
<span style="font-weight: bold"><span style="color: #000080">import</span></span> pyBasso
<span style="font-weight: bold"><span style="color: #000080">import</span></span> numpy as np

<span style="font-style: italic"><span style="color: #9A1900"># create source and target space</span></span>
X <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">create_LpSpace</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">.,</span> <span style="color: #993399">2</span><span style="color: #990000">.)</span>
Y <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">create_LpSpace</span></span><span style="color: #990000">(</span><span style="color: #993399">12</span><span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">.,</span> <span style="color: #993399">2</span><span style="color: #990000">.)</span>

<span style="font-style: italic"><span style="color: #9A1900"># create the matrix in some way</span></span>
matrix <span style="color: #990000">=</span> np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">asarray</span></span><span style="color: #990000">(</span>np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">zeros</span></span><span style="color: #990000">((</span><span style="color: #993399">12</span><span style="color: #990000">,</span><span style="color: #993399">10</span><span style="color: #990000">)))</span>
<span style="font-style: italic"><span style="color: #9A1900"># convert the matrix to the Eigen format using minieigen</span></span>
M <span style="color: #990000">=</span> minieigen<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">MatrixX</span></span><span style="color: #990000">(</span>matrix<span style="color: #990000">)</span>

<span style="font-style: italic"><span style="color: #9A1900"># instantiate the LinearMapping</span></span>
A <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">create_LinearMapping</span></span><span style="color: #990000">(</span>X<span style="color: #990000">,</span>Y<span style="color: #990000">,</span> M<span style="color: #990000">,</span> False<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The <strong>matrix</strong> needs to be converted from a numpy array to a <span class="monospaced">Eigen::MatrixXd</span>
using <span class="monospaced">minieigen</span>. Finally, we create <strong>A</strong>, the linear mapping.</p></div>
<div class="paragraph"><p>As a test, let us map an element of space <strong>X</strong> to space <strong>Y</strong>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>x <span style="color: #990000">=</span> X<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createElement</span></span><span style="color: #990000">()</span>
x<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">.</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>X<span style="color: #990000">.</span>space<span style="color: #990000">.</span>dim<span style="color: #990000">)</span>

Ax <span style="color: #990000">=</span> A<span style="color: #990000">*</span>x
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>Ax<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>Ax<span style="color: #990000">.</span>space<span style="color: #990000">.</span>dim<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>We see that <strong>x</strong> has the dimension of <strong>X</strong>, while the mapped element <strong>Ax</strong> has
the dimension of <strong>Y</strong> (and is also associated with it). Naturally, the mapping
is boring as the matrix is identical to zero in every component. However, we
could have used any other numpy array.</p></div>
</div>
<div class="sect2">
<h3 id="python.options">4.3. (Command-line) Options</h3>
<div class="paragraph"><p>The <span class="monospaced">Options</span> class contains all parameters that steer how the iterative solvers
work. It is the general parameter storage.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> pyBasso

opts <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Options</span></span><span style="color: #990000">()</span>
opts<span style="color: #990000">.</span>algorithm_name <span style="color: #990000">=</span> <span style="color: #FF0000">"Landweber"</span></tt></pre></div></div>
<div class="paragraph"><p>In this case, we instantiate an <span class="monospaced">Options</span> class and set its property <span class="monospaced">algorithm_name</span>
to <strong>Landweber</strong>. This is the name of the iterative solver, here we want to use
the Landweber method for solving inverse problems.</p></div>
<div class="paragraph"><p>For a list of all properties we refer to the respective <strong>docstring</strong> using
<span class="monospaced">help(pyBasso.Options)</span>.</p></div>
</div>
<div class="sect2">
<h3 id="python.inverse_problem">4.4. Inverse problems</h3>
<div class="paragraph"><p>Let us now set up an inverse problem. For this, we create a random numpy array
that will become our (random) linear operator <strong>A</strong>. Moreover, we create a random
right-hand side <strong>y</strong>. As before, we need to instantiate two normed vector spaces
in order to create a linear mapping using the random matrix.</p></div>
<div class="paragraph"><p>Again, matrices and vectors are converted from numpy arrays to the Eigen format
using <span class="monospaced">minieigen</span> routines.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># IMPORTANT: minieigen before pyBasso!!</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> minieigen
<span style="font-weight: bold"><span style="color: #000080">import</span></span> pyBasso
<span style="font-weight: bold"><span style="color: #000080">import</span></span> numpy as np

<span style="font-style: italic"><span style="color: #9A1900"># make random arrays reproducible</span></span>
np<span style="color: #990000">.</span>random<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">seed</span></span><span style="color: #990000">(</span><span style="color: #993399">426</span><span style="color: #990000">)</span>

<span style="font-style: italic"><span style="color: #9A1900"># create spaces</span></span>
X <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">create_LpSpace</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">.,</span> <span style="color: #993399">2</span><span style="color: #990000">.)</span>
Y <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">create_LpSpace</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">.,</span> <span style="color: #993399">2</span><span style="color: #990000">.)</span>

<span style="font-style: italic"><span style="color: #9A1900"># create A and y</span></span>
matrix <span style="color: #990000">=</span> np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">asarray</span></span><span style="color: #990000">(</span>np<span style="color: #990000">.</span>random<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">uniform</span></span><span style="color: #990000">(</span>low<span style="color: #990000">=-</span><span style="color: #993399">1</span><span style="color: #990000">.,</span> high<span style="color: #990000">=</span><span style="color: #993399">1</span><span style="color: #990000">.,</span> size<span style="color: #990000">=(</span><span style="color: #993399">10</span><span style="color: #990000">,</span><span style="color: #993399">10</span><span style="color: #990000">)))</span>
righthandside <span style="color: #990000">=</span> np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">asarray</span></span><span style="color: #990000">(</span>np<span style="color: #990000">.</span>random<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">uniform</span></span><span style="color: #990000">(</span>low<span style="color: #990000">=-</span><span style="color: #993399">1</span><span style="color: #990000">.,</span> high<span style="color: #990000">=</span><span style="color: #993399">1</span><span style="color: #990000">.,</span> size<span style="color: #990000">=(</span><span style="color: #993399">10</span><span style="color: #990000">)))</span>

<span style="font-style: italic"><span style="color: #9A1900"># convert matrix and vector to Eigen format</span></span>
M <span style="color: #990000">=</span> minieigen<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">MatrixX</span></span><span style="color: #990000">(</span>matrix<span style="color: #990000">)</span>
rhs <span style="color: #990000">=</span> minieigen<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">VectorX</span></span><span style="color: #990000">(</span>righthandside<span style="color: #990000">)</span>

<span style="font-style: italic"><span style="color: #9A1900"># create linear mapping</span></span>
A <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">create_LinearMapping</span></span><span style="color: #990000">(</span>X<span style="color: #990000">,</span>Y<span style="color: #990000">,</span> M<span style="color: #990000">,</span> False<span style="color: #990000">)</span>

<span style="font-style: italic"><span style="color: #9A1900"># create right-hand side as proper element of space Y</span></span>
y <span style="color: #990000">=</span> Y<span style="color: #990000">.</span>dualspace<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createElement</span></span><span style="color: #990000">()</span>
y<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span>rhs<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Now, the random vector is not generally in the range of our random matrix.
Therefore, we use a little procedure to have it in its range.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">projectOntoRange</span></span><span style="color: #990000">(</span>A<span style="color: #990000">,</span> y<span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">  """ Projects given \a y onto the range of \a A and returns it.</span></span>

<span style="font-style: italic"><span style="color: #9A1900">  See [Schuster, Schpfer, 2006] for details.</span></span>

<span style="font-style: italic"><span style="color: #9A1900">  Args:</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    A: mapping</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    y: space element to project onto range of mapping \a A</span></span>

<span style="font-style: italic"><span style="color: #9A1900">  Returns:</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    space element in range of operator/mapping</span></span>
<span style="font-style: italic"><span style="color: #9A1900">  """</span></span>
  X <span style="color: #990000">=</span> A<span style="color: #990000">.</span>sourcespace
  J_p <span style="color: #990000">=</span> X<span style="color: #990000">.</span>dualspace<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getDualityMapping</span></span><span style="color: #990000">()</span>
  Asys <span style="color: #990000">=</span> A<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">adjoint</span></span><span style="color: #990000">(</span>y<span style="color: #990000">)</span>
  precursor <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">J_p</span></span><span style="color: #990000">(</span>Asys<span style="color: #990000">)</span>
  xmin <span style="color: #990000">=</span> precursor<span style="color: #990000">*(</span><span style="color: #993399">1</span><span style="color: #990000">./</span>precursor<span style="color: #990000">.</span>norm<span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> A<span style="color: #990000">*</span>xmin</tt></pre></div></div>
<div class="paragraph"><p>In our case <strong>J_p</strong> does nothing as we use $\ell_2$-spaces, however
in case <strong>p</strong> is not 2, then we need it.</p></div>
<div class="paragraph"><p>Finally, we instantiate the inverse problem, set up the options to prepare the
solvers and then we solve it.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>y <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">projectOntoRange</span></span><span style="color: #990000">(</span>A<span style="color: #990000">,</span>y<span style="color: #990000">)</span>
inverse_problem <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">InverseProblem</span></span><span style="color: #990000">(</span>A<span style="color: #990000">,</span> X<span style="color: #990000">,</span> Y<span style="color: #990000">,</span> y<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900"># create opts: algorithm, stopping_criteria and parameters</span></span>
opts <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Options</span></span><span style="color: #990000">()</span>
opts<span style="color: #990000">.</span>algorithm_name <span style="color: #990000">=</span> <span style="color: #FF0000">"SESOP"</span>
opts<span style="color: #990000">.</span>delta <span style="color: #990000">=</span> <span style="color: #993399">0.001</span>
opts<span style="color: #990000">.</span>C <span style="color: #990000">=</span> <span style="color: #993399">1</span>
opts<span style="color: #990000">.</span>maxiter <span style="color: #990000">=</span> <span style="color: #993399">1000</span>
opts<span style="color: #990000">.</span>stopping_criteria <span style="color: #990000">=</span> <span style="color: #FF0000">"RelativeResiduum || MaxIterationCount"</span>
opts<span style="color: #990000">.</span>orthogonalization_type <span style="color: #990000">=</span> <span style="color: #993399">1</span> <span style="font-style: italic"><span style="color: #9A1900"># MetricProjection</span></span>
opts<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setValues</span></span><span style="color: #990000">()</span>
opts<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setVerbosity</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">)</span>

<span style="font-style: italic"><span style="color: #9A1900"># create zero start value and solve</span></span>
xstart <span style="color: #990000">=</span> X<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createElement</span></span><span style="color: #990000">()</span>
inverse_problem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">solve</span></span><span style="color: #990000">(</span>opts<span style="color: #990000">,</span> xstart<span style="color: #990000">)</span>

<span style="font-style: italic"><span style="color: #9A1900"># print solution</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Expected solution: "</span><span style="color: #990000">+</span><span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">(</span>xmin<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Approximate solution: "</span><span style="color: #990000">+</span><span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">(</span>inverse_problem<span style="color: #990000">.</span>x<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Norm of difference: "</span><span style="color: #990000">+</span><span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">((</span>inverse_problem<span style="color: #990000">.</span>x<span style="color: #990000">-</span>xmin<span style="color: #990000">).</span>norm<span style="color: #990000">))</span></tt></pre></div></div>
<div class="paragraph"><p>This will use <strong>orthoSESOP</strong> to solve for the minimum-norm solution in these
Hilbert spaces for up to 1000 steps or if the residuum has a relative change
less than $10^{-4}$.</p></div>
<div class="sect3">
<h4 id="python.inverse_problem.range_projection">4.4.1. Range projection</h4>
<div class="paragraph"><p>One often encountered intermediate problem is to project the right-hand side
first onto the range of the mapping before solving the inverse problem without
requiring regularization.</p></div>
<div class="paragraph"><p>This work in just the same way as the solving of a normal inverse problem.
The only difference lies in calling <span class="monospaced">project()</span> in place of <span class="monospaced">solve()</span>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># create zero start value and project onto range</span></span>
xstart <span style="color: #990000">=</span> Y<span style="color: #990000">.</span>dualspace<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createElement</span></span><span style="color: #990000">()</span>
inverse_problem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">project</span></span><span style="color: #990000">(</span>opts<span style="color: #990000">,</span> xstart<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Projected rhs: "</span><span style="color: #990000">+</span><span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">(</span>inverse_problem<span style="color: #990000">.</span>y<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Norm difference: "</span><span style="color: #990000">+</span><span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">((</span>inverse_problem<span style="color: #990000">.</span>y<span style="color: #990000">-</span>y<span style="color: #990000">).</span>norm<span style="color: #990000">))</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="python.inverse_problem.general">4.4.2. More general inverse problems</h4>
<div class="paragraph"><p>We can do even more: We can solve not only linear inverse problems but also
general inverse problems.</p></div>
<div class="paragraph"><p>All we need to do is specify a Python <strong>mapping</strong> and a <strong>derivative</strong> function.
For this example, we will use the same matrix as before (i.e., it is still a
linear mapping) but an arbitrary function could be used.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">mapping</span></span><span style="color: #990000">(</span>_argument<span style="color: #990000">):</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> M <span style="color: #990000">*</span> _argument

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">derivative</span></span><span style="color: #990000">(</span>_argument<span style="color: #990000">):</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> M<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">transpose</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p>Here, <strong>M</strong> is the converted random matrix. Note that <span class="monospaced">mapping()</span> returns a
<span class="monospaced">minieigen::Vector</span> and <span class="monospaced">derivative()</span> returns a <span class="monospaced">minieigen:Matrix</span>, the
Jacobian.</p></div>
<div class="paragraph"><p>Next, the only difference to the above is that we create the <span class="monospaced">Mapping</span> class
as follows.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>A <span style="color: #990000">=</span> pyBasso<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">create_NonLinearMapping</span></span><span style="color: #990000">(</span>X<span style="color: #990000">,</span>Y<span style="color: #990000">,</span> mapping<span style="color: #990000">,</span> derivative<span style="color: #990000">,</span> False<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The last argument <span class="monospaced">False</span> states the mapping is not in the adjoint form already.</p></div>
<div class="paragraph"><p>All else proceeds just in the same way as in the example with the linear
mapping before.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="python.conclusion">4.5. Conclusion</h3>
<div class="paragraph"><p>This concludes the discussion of the Python interface of BASSO. All remaining
section will now focus again on the C++ parts. However, it should have
become clear that this interface lends itself well to solve inverse problems
in a straight-forward fashion taking full advantage of BASSO.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples">5. Examples</h2>
<div class="sectionbody">
<div class="paragraph"><p>We have implemented a number of typical inverse problems using BASSO. These are
command-line programs that take all required parameters as arguments using the
<span class="monospaced">boost::program_options</span> library. See the <span class="monospaced">Examples</span> folder and all subfolders
therein.</p></div>
<div class="paragraph"><p>Note that basically all examples come with an additional program
<span class="monospaced">...Configurator</span> that writes command-line options into a file. This is to allow
reproducible runs where all employed options can be inspected at any time for a
given result.</p></div>
<div class="paragraph"><p>The recommended procedure is to first call the Configurator program giving it
all required options. In a second step the actual example is called with the
only option being <span class="monospaced">... --config basso.opt</span>, where <strong>basso.opt</strong> would be the
configuration file name. At any later point in time you can easily see what
options produced the respective output files by looking at this file.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">All files to the example calls below are stored in the folder
<strong>doc/examples/pre</strong>.</td>
</tr></table>
</div>
<div class="sect2">
<h3 id="examples.basso">5.1. BASSO</h3>
<div class="paragraph"><p>The main program which solves any kind of inverse problem given in the form of
two files containing the matrix and the right-hand side vector has the same name
as the library itself, namely <strong>BASSO</strong>.</p></div>
<div class="paragraph"><p>In the following we use it to solve a simple problem which has been investigated
in <a href="#Schoepfer2006">[Schoepfer2006</a>]: Determine the point on a line (in two
dimensions) which has minimal distance to the origin in the
\ell_p-norm.</p></div>
<div class="mathblock">
<div class="content">A = \begin{pmatrix} 2 & 1 \\ 2 & 1 \end{pmatrix}, \quad y = \begin{pmatrix} 2 \\ 2 \end{pmatrix}</div></div>
<div class="paragraph"><p>We encode the <strong>matrix</strong> A and the <strong>vector</strong> y in the files <em>matrix.m</em> and
<em>vector.m</em>, respectively.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">BASSO uses the <em>MatLab/Octave file format</em> with its typical <em>.m</em> suffix in
its file formats. This allows to use Octave to easily create, read, and write
matrix or vectors from and to files. See
<a href="https://octave.org/doc/v4.2.1/Simple-File-I_002fO.html">Simple File I/O</a> for
details. The file parsing is handled by the <span class="monospaced">MatrixIO</span> class, see
<a href="#MatrixIO">#MatrixIO</a>.</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>Basso <span style="color: #990000">\</span>
  --algorithm Landweber <span style="color: #990000">\</span>
  --type-space-x <span style="color: #FF0000">"lp"</span> <span style="color: #990000">\</span>
  --px <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --powerx <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --type-space-y <span style="color: #FF0000">"lp"</span> <span style="color: #990000">\</span>
  --py <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --powery <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --delta <span style="color: #993399">0.0001</span> <span style="color: #990000">\</span>
  --C <span style="color: #993399">1</span> <span style="color: #990000">\</span>
  --maxiter <span style="color: #993399">50</span> <span style="color: #990000">\</span>
  --iteration-file Landweber1<span style="color: #990000">.</span>db <span style="color: #990000">\</span>
  --matrix matrix<span style="color: #990000">.</span>m <span style="color: #990000">\</span>
  --rhs vector<span style="color: #990000">.</span>m <span style="color: #990000">\</span>
  --solution straightline1<span style="color: #990000">.</span>m</tt></pre></div></div>
<div class="paragraph"><p>In this call of <em>Basso</em> we use the Landweber with $\mathrm{X}$ and
$\mathrm{Y}$ being \ell_2-spaces. We terminate when the
residual is less than 1e-4 and use at most 50 iterations. All information on the
iterations is written to an SQLite database file <em>Landweber1.db</em>. This database
contains tables <span class="monospaced">data_per_iteration</span> and <span class="monospaced">data_overall</span> tables along with
specific views <span class="monospaced">per_iteration</span> and <span class="monospaced">overall</span>, see the class <span class="monospaced">DatabaseManager</span>.
The solution, the point closest to the origin on the line described by
$A$, is written to <em>straightline1.m</em>.</p></div>
</div>
<div class="sect2">
<h3 id="examples.gravity">5.2. Gravity</h3>
<div class="paragraph"><p>In the very nice book <a href="#Hansen2010">[Hansen2010</a>] an example of finding the
gravitational constant is given. We have implemented this example in the context
of BASSO.</p></div>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>An unknown mass distribution with density f(t) is located at depth d below the
surface, from 0 to 1 on the t axis [shown in Figure 2.1]. We assume there is no
mass outside the source, which produces a gravity field everywhere. At the
surface along the s axis (see the figure) from 0 to 1, we measure the vertical
component of the gravity field, which we refer to as g(s).</p></div>
</div>
<div class="attribution">
<em>P.C. Hansen</em><br>
&#8212; Discrete Inverse Problems - Insight and Algorithms
</div></div>
<div class="paragraph"><p>This is the problem we have to solve: There is a one-dimensional manifold with
"mass" at some distance d to our measurement device. At the surface&#8201;&#8212;&#8201;the one
dimensional manifold where our device sits&#8201;&#8212;&#8201;we feel the combined effect of the
mass on the whole manifold but always diminished by the distance to the
respective point mass at f(t). We have information only of the measured gravity
field g(s) and now want to deduce the mass distribution f(t). This is our
inverse problem: We have the cause. Now we want to know what&#8217;s the source of it.</p></div>
<div class="paragraph"><p>What we need is a equation that relates the two: This is known by the name of Fredholm integral equation of the first kind, see <a href="#Hansen2010">[Hansen2010</a>].</p></div>
<div class="paragraph"><p>$\int_0^1 K(s,t)  f(t) dt = g(s), \quad 0 \leq s \leq 1$,</p></div>
<div class="paragraph"><p>$K(s,t)$ here is called the "kernel". If the kernel is linear and we
discretize the x axis by using a set of equidistant points along it, we obtain a
matrix and the equation becomes the typical inverse problems that we know
already: $Ax=y$.</p></div>
<div class="paragraph"><p>$K(s,t) = \frac{d} {\bigl (d^2+(s-t)^2 \bigr)^{\tfrac 3 2}}$.</p></div>
<div class="paragraph"><p>This equation for the kernel results from knowing that the magnitude of the
gravity field along s behaves as $f(t)dt/r^2$, where $r =\sqrt{d^2 + (s-t)^2}$
is the distance between the source point s and the field point t.</p></div>
<div class="paragraph"><p>This has been encoded in the example <strong>Gravity</strong> which is called as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>Gravity <span style="color: #990000">\</span>
  --type-space-x <span style="color: #FF0000">"lp"</span> <span style="color: #990000">\</span>
  --px <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --type-space-y <span style="color: #FF0000">"lp"</span> <span style="color: #990000">\</span>
  --py <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --powery <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --maxiter <span style="color: #993399">10</span> <span style="color: #990000">\</span>
  --delta <span style="color: #993399">0.01</span> <span style="color: #990000">\</span>
  --depth <span style="color: #993399">0.5</span> <span style="color: #990000">\</span>
  --discretization <span style="color: #993399">10</span> <span style="color: #990000">\</span>
  --density-file density<span style="color: #990000">.</span>m</tt></pre></div></div>
<div class="paragraph"><p>The resulting density is stored as a vector in <strong>density.m</strong>.</p></div>
</div>
<div class="sect2">
<h3 id="examples.computer_tomography">5.3. ComputerTomography</h3>
<div class="paragraph"><p>In computerized tomography the inverse problem is the reconstruction of the
inside of an object from projections. Measurements are for example obtained by
passing radiation through a body, whereby their intensity is diminished,
proportional to the passed length and density $f(x)$ of the body:
[0,1] $^2 \rightarrow R^{+}_{0}$. This decrease is measured over a
$a$ angles and $s$ shifts of radiation source and detectors.
This measurement matrix is usually called <strong>sinogram</strong>. Again, we follow
<a href="#Hansen2010">[Hansen2010, 7.7</a>].</p></div>
<div class="paragraph"><p>In (2D) tomography much depends on how the measurement is obtained. Rays might
pass through the body in parallel or in fan-like formation. This depends on
the setup of the detectors. There might be just a single, point-like detector
that is rotated in conjunction with the radiation source around the object on
a sphere. The detector might also be spread out, detecting along several small
line segments.</p></div>
<div class="paragraph"><p>In our case we assume single rays, these are suitable parametrized. When the
radiation passes through an object, the effect on its intensity is described
by the Lambert-Beer law, $dI = I_0 \exp{ f(x) dx}$. Given some
initial intensity $I_0$ it is diminished when travelling
$dx$ through the body $f(x)$ by $dI$.</p></div>
<div class="paragraph"><p>This can be written as the famous <strong>Radon transform</strong>,</p></div>
<div class="paragraph"><p>$b_i = \int_{-\infty}^{\infty} f(t^i(\tau)) d\tau$,</p></div>
<div class="paragraph"><p>where i enumerates all rays passed through the body and $t^i$ is the
respective parametrization in 2D, $t^i = t^{i,0} + \tau d^i$ with
the direction of the ray d and $i=s \cdot a$ rays in total.</p></div>
<div class="paragraph"><p>The problem is typically discretized in a pixel basis and for setting up the
Radon matrix we need to count the length of the ray passing through each of
the pixels.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The pixels in 2D are vectorized and the matrix is over all pixels and
over all grid points of the body&#8217;s density $f(x)$.</td>
</tr></table>
</div>
<div class="paragraph"><p>Eventually, we obtain a matrix equation: $b_i = \sum_j a_{ij} x_j$.</p></div>
<div class="paragraph"><p>Again, this is the inverse problem that we need to solve.</p></div>
<div class="paragraph"><p>The example program contained with BASSO is called <em>ComputerTomography</em>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>ComputerTomography <span style="color: #990000">\</span>
  --type-space-x <span style="color: #FF0000">"lp"</span> <span style="color: #990000">\</span>
  --px <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --type-space-y <span style="color: #FF0000">"lp"</span> <span style="color: #990000">\</span>
  --py <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --powery <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --delta <span style="color: #993399">0.01</span> <span style="color: #990000">\</span>
  --maxiter <span style="color: #993399">50</span> <span style="color: #990000">\</span>
  --num-angles <span style="color: #993399">60</span> <span style="color: #990000">\</span>
  --num-offsets <span style="color: #993399">61</span> <span style="color: #990000">\</span>
  --num-pixels-x <span style="color: #993399">21</span> <span style="color: #990000">\</span>
  --num-pixels-y <span style="color: #993399">21</span> <span style="color: #990000">\</span>
  --solution solution<span style="color: #990000">.</span>mat <span style="color: #990000">\</span>
  --sinogram pre/sinogram<span style="color: #990000">.</span>mat</tt></pre></div></div>
<div class="paragraph"><p>The reconstructed image is written to <strong>solution.mat</strong>. Changing the norm
<strong>px</strong> changes the reconstruction. It is advised to play around with different
values in $(1, \infty)$. Note especially how a value close to 1
for p produces a higher contrast but also more noisy artefacts.</p></div>
<div class="paragraph"><p>For a problem with a noisy right-hand side we have the following example.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>ComputerTomography <span style="color: #990000">\</span>
  --type-space-x <span style="color: #FF0000">"lp"</span>  <span style="color: #990000">\</span>
  --px <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --type-space-y <span style="color: #FF0000">"lp"</span>  <span style="color: #990000">\</span>
  --py <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --powery <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --delta <span style="color: #993399">0.01</span>  <span style="color: #990000">\</span>
  --maxiter <span style="color: #993399">50</span> <span style="color: #990000">\</span>
  --noise-level <span style="color: #993399">0.01</span> <span style="color: #990000">\</span>
  --num-angles <span style="color: #993399">40</span> <span style="color: #990000">\</span>
  --num-offsets <span style="color: #993399">41</span> <span style="color: #990000">\</span>
  --num-pixels-x <span style="color: #993399">41</span> <span style="color: #990000">\</span>
  --num-pixels-y <span style="color: #993399">41</span> <span style="color: #990000">\</span>
  --solution solution<span style="color: #990000">.</span>mat <span style="color: #990000">\</span>
  --phantom pre/phantom<span style="color: #990000">.</span>mat</tt></pre></div></div>
<div class="paragraph"><p>Here, we have the famous Shepp-Logan phantom encoded in <strong>phantom.mat</strong> which
is turned into a right-hand side through $Ax=y$ and perturbed by
additional noise of 1% magnitude. The resulting solution is again written to
<strong>solution.mat</strong>. Again, we recommend to play around with <strong>px</strong> and
<strong>noise-level</strong>.</p></div>
</div>
<div class="sect2">
<h3 id="examples.matrix_factorizer">5.4. MatrixFactorizer</h3>
<div class="paragraph"><p>One last and more complicated program that has been investigated in the course
of the BMBF funded project <a href="https://www.math.uni-sb.de/hypermath/">HYPERMATH</a>
is the matrix factorization as two alternating inverse problems.</p></div>
<div class="paragraph"><p>In HYPERMATH we looked at hyperspectral images. These are images that contain
not only three colors but thousands of different channels. These images were
taken by many different measurement methods: Near-Infrared Spectroscopy (NIR),
Matrix Assisted Laser Deposition and Imaging (MALDI), Raman spectroscopy or
Spark Optical Emission Spectroscopy (OES). The channels were either truly
electromagnetic channels (NIR, Raman), particles masses (MALDI) or elemental
abundances (OES). The images per channel consisted of a 2D measurement grid of
different objects.</p></div>
<div class="paragraph"><p>Hyperspectral images are typically very large. $10^6$ to $10^8$
number of pixels and $10^3$ to $10^5$ number of
channels are typically encountered, causing up to $10^{12}$ degrees
of freedom to be stored. Hence, these are big data.</p></div>
<div class="paragraph"><p>One crucial problem is therefore storage. The central idea of the HYPERMATH
project is to use matrix factorization. The measurements are seen as a large
matrix where one dimension is the number of pixels and the other is the number
of channels. The underlying assumption is that the measurement is caused by
the linear superposition of a few <strong>endmembers</strong>. For example, in Raman
spectroscopy biological tissue is investigated. Spectrographical patterns
are caused by the molecules that make up the tissue. There, the endmembers
consist of the spectra of each of those individual molecules.</p></div>
<div class="paragraph"><p>(Non-negative) Matrix factorization will then decouple the superimposed effects
of all these endmembers. It splits the measurement matrix A into two factors
K and X, where K contains relations from channels to endmembers and X from
endmembers to pixels, $A = K \cdot X$.</p></div>
<div class="paragraph"><p>If the number of reconstructed endmembers is much smaller than the number of
pixels or channels, then the storage requirement of both K and X is much
smaller than that of the original matrix A.</p></div>
<div class="paragraph"><p>This problem can be written as two different inverse problems: First, consider
each row in X and each row in A. We obtain $A_i = K X_i$, where K is
the matrix to formally invert. The other way round, looking at rows, we obtain
$A_j = K_j X$. Now, $X^t$ is the matrix to invert.</p></div>
<div class="paragraph"><p>Next, we perform an alternating least squares minimization, where each inverse
problem is solved in turn for a few iterations. This will converge to the
two factors we are looking for.</p></div>
<div class="paragraph"><p>Moreover, this problem can be seen as a split feasibility problem, where
each constraint is addressed one by the other. This allows to add further
constrains on the factors K and X. For example, row sums might need to be
unity or similar.</p></div>
<div class="paragraph"><p>In the example program <em>MatrixFactorizer</em> this method is implemented.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>MatrixFactorizer  <span style="color: #990000">\</span>
  --type-space-x <span style="color: #FF0000">"lp"</span>  <span style="color: #990000">\</span>
  --px <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --type-space-y <span style="color: #FF0000">"lp"</span>  <span style="color: #990000">\</span>
  --py <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --powery <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --delta <span style="color: #993399">1e-6</span> <span style="color: #990000">\</span>
  --projection-delta <span style="color: #993399">1e-6</span> <span style="color: #990000">\</span>
  --maxiter <span style="color: #993399">50</span> <span style="color: #990000">\</span>
  --max-loops <span style="color: #993399">11</span> <span style="color: #990000">\</span>
  --orthogonal-directions <span style="color: #993399">1</span> <span style="color: #990000">\</span>
  --number-directions <span style="color: #993399">1</span> <span style="color: #990000">\</span>
  --sparse-dim <span style="color: #993399">1</span> <span style="color: #990000">\</span>
  --residual-threshold <span style="color: #993399">1e-4</span> <span style="color: #990000">\</span>
  --auxiliary-constraints <span style="color: #FF0000">"Nonnegative"</span> <span style="color: #990000">\</span>
  --max-sfp-loops <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --data pre/data<span style="color: #990000">.</span>m  <span style="color: #990000">\</span>
  --solution-first-factor spectralmatrix_rank2_nonnegative<span style="color: #990000">.</span>m <span style="color: #990000">\</span>
  --solution-second-factor pixelmatrix_rank2_nonnegative<span style="color: #990000">.</span>m</tt></pre></div></div>
<div class="paragraph"><p>We only briefly go over the new options:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>projection-delta</strong> is the threshold to stop the projection onto the range
of either matrix K or X. As we do not know the noise levels, we cannot use a
suitable early stopping condition. Therefore, we project the columns and rows
into the matrix' range before solving the inverse problem.
</p>
</li>
<li>
<p>
<strong>sparse-dim</strong> is the number of endpoints we look for.
</p>
</li>
<li>
<p>
<strong>data</strong> gives the measurement matrix.
</p>
</li>
<li>
<p>
<strong>max-loops</strong> is the number of alternative least squares iterations.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Eventually, the two low-rank factors are stored in the files <strong>spectralmatrix_rank2_nonnegative.m</strong>
and <strong>pixelmatrix_rank2_nonnegative.m</strong>.</p></div>
</div>
<div class="sect2">
<h3 id="examples.helpers">5.5. Helper programs</h3>
<div class="paragraph"><p>BASSO comes with several small helper programs that aid in setting up problems,
perturbing right hand sides or projecting onto the range of the given matrix.</p></div>
<div class="sect3">
<h4 id="examples.helpers.noise_adder">5.5.1. NoiseAdder</h4>
<div class="paragraph"><p><em>NoiseAdder</em> adds a specific amount of white noise to a given vector.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>NoiseAdder <span style="color: #990000">\</span>
  --verbose <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --input pre/vector<span style="color: #990000">.</span>m <span style="color: #990000">\</span>
  --output solution_vector<span style="color: #990000">.</span>mat <span style="color: #990000">\</span>
  --noise-level <span style="color: #993399">0.1</span> <span style="color: #990000">\</span>
  --relative-level <span style="color: #993399">1</span> <span style="color: #990000">\</span></tt></pre></div></div>
<div class="paragraph"><p>Here, <strong>relative-level</strong> states whether the noise is relative (1) or absolute
(0) to the given vector in <strong>vector.m</strong>.</p></div>
</div>
<div class="sect3">
<h4 id="examples.helpers.range_projector">5.5.2. RangeProjector</h4>
<div class="paragraph"><p><em>RangeProjector</em> projects onto the range of a matrix. This is again an inverse
problem. The program however sets it up as a split feasibility problem to allow
additional constraints to be fulfilled in the projection, e.g. non-negativity.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>RangeProjectorConfigurator <span style="color: #990000">\</span>
  --verbose <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --type-space-x <span style="color: #FF0000">"lp"</span>  <span style="color: #990000">\</span>
  --px <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --type-space-y <span style="color: #FF0000">"lp"</span>  <span style="color: #990000">\</span>
  --py <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --powery <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --delta <span style="color: #993399">1e-8</span>  <span style="color: #990000">\</span>
  --matrix pre/rp_matrix<span style="color: #990000">.</span>m  <span style="color: #990000">\</span>
  --rhs pre/rp_vector<span style="color: #990000">.</span>m <span style="color: #990000">\</span>
  --solution solution<span style="color: #990000">.</span>mat</tt></pre></div></div>
<div class="paragraph"><p>The projected vector that is closest in the sense of the employed norm of
$\mathrm{Y}$ to the original right-hand side is written to the file
<strong>solution.mat</strong>.</p></div>
</div>
<div class="sect3">
<h4 id="examples.helpers.matrix_to_png">5.5.3. MatrixToPNG</h4>
<div class="paragraph"><p><em>MatrixToPNG</em> converts a vector into a PNG image file.</p></div>
<div class="paragraph"><p>Images are 2D and therefore one would expect a matrix. In computerized
tomography, the image information is vectorized. Hence, this program expects a
vector.</p></div>
<div class="paragraph"><p>It supports different color tables: <strong>redgreen</strong>, <strong>reedblue</strong>, <strong>bluegreenred</strong>,
<strong>blueblackred</strong>, and <strong>blackwhite</strong>.</p></div>
<div class="paragraph"><p>The image can be automatically flipped or mirrored, see the options <strong>flip</strong>,
<strong>left-to-right</strong>, <strong>bottom-to-top</strong>, and <strong>rotate</strong>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>MatrixToPNG <span style="color: #990000">\</span>
  --image blackwhite_positive<span style="color: #990000">.</span>png <span style="color: #990000">\</span>
  --num-pixels-x <span style="color: #993399">11</span> <span style="color: #990000">\</span>
  --num-pixels-y <span style="color: #993399">1</span> <span style="color: #990000">\</span>
  --colorize blackwhite <span style="color: #990000">\</span>
  --matrix pre/positive<span style="color: #990000">.</span>mat</tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="examples.helpers.radon_matrix_writer">5.5.4. RadonMatrixWriter</h4>
<div class="paragraph"><p><em>RadonMatrixWriter</em> writes the Radon transform discretized in a pixel basis to
a file such that it forms the matrix in the inverse problem of 2D computerized
tomography.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>RadonMatrixWriter  <span style="color: #990000">\</span>
  --num-pixels-x <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --num-pixels-y <span style="color: #993399">2</span> <span style="color: #990000">\</span>
  --num-angles <span style="color: #993399">2</span>  <span style="color: #990000">\</span>
  --num-offsets <span style="color: #993399">3</span> <span style="color: #990000">\</span>
  --radon-matrix radon<span style="color: #990000">.</span>mat</tt></pre></div></div>
<div class="paragraph"><p>The resulting file is placed in <strong>radon.mat</strong>. Note that the number of pixels,
angles, and offsets is much too small here as this is taken from a test case.
Typically, they should be around $10^2$.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference">6. Reference</h2>
<div class="sectionbody">
<div class="paragraph"><p>In this reference we explain how the major interface classes are used.</p></div>
<div class="sect2">
<h3 id="reference.NormedSpace">6.1. NormedSpace and NormedSpaceFactory</h3>
<div class="paragraph"><p>A finite-dimensional (Banach) space is instantiated using the <span class="monospaced">NormedSpace</span>
class by giving its constructor the dimension of the space and a norm object,
<span class="monospaced">NormedSpace X(200, norm);`</span></p></div>
<div class="paragraph"><p>However, a norm cannot be constructed without a space. Both are tightly
interlinked in BASSO (through <span class="monospaced">boost::shared_ptr</span>). Hence, the typical way of
setting up a space is by using the <span class="monospaced">NormedSpaceFactory</span>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Minimizations/InverseProblems/InverseProblems/Factory.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Minimizations/Space/NormedSpaceFactory.hpp"</span>

InverseProblemFactory<span style="color: #990000">::</span><span style="color: #008080">args_t</span> args_SpaceX<span style="color: #990000">;</span>
args_SpaceX <span style="color: #990000">+=</span> boost<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">any</span></span><span style="color: #990000">(</span><span style="color: #993399">1.1</span><span style="color: #990000">),</span> boost<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">any</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">.);</span>
<span style="color: #008080">NormedSpace__ptr_t</span> X <span style="color: #990000">=</span> NormedSpaceFactory<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">create</span></span><span style="color: #990000">(</span><span style="color: #993399">200</span><span style="color: #990000">,</span> <span style="color: #FF0000">"lp"</span><span style="color: #990000">,</span> args_SpaceX<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Here, we need to specify not only the dimension but also the properties of the
norm. We set the type of the norm to be "lp" (or "regularized_l1"), see the
static function <span class="monospaced">NormFactory::getMap()</span> for all options.</p></div>
<div class="paragraph"><p>Moreover, we need to give the space&#8217;s parameters. An lp-space needs the value of
p and also the power type to create the associated duality mapping. As the
number of parameters differ over the different available norms, they are given
as a vector of <span class="monospaced">boost::any</span> arguments. Here, we set p to 1.1 and the power type
to 2.</p></div>
<div class="paragraph"><p>Finally, the <span class="monospaced">NormedSpaceFactory::create()</span> function returns the constructed
instance of the <span class="monospaced">NormedSpace</span> class. Note that it is wrapped in a
<span class="monospaced">boost:shared_ptr</span> and is deconstructed automatically when it is no longer used.
In other words, don&#8217;t worry about it, just use it like a static instance except
you need to dereference it using the <span class="monospaced">*</span> operator on use. Hence, the type has
been kept the <span class="monospaced">.._ptr_t</span> ending to remind you that you need to access its
members like <span class="monospaced">X-&gt;getNorm()</span>, i.e. like a normal pointer.</p></div>
</div>
<div class="sect2">
<h3 id="reference.SpaceElement">6.2. SpaceElement</h3>
<div class="paragraph"><p>The <span class="monospaced">SpaceElement</span> class wraps a <span class="monospaced">Eigen::VectorXd</span> and associates it directly
with a certain space, see <span class="monospaced">getSpace()</span>. All typical linear algebra routines such
as vector product, scalar product, addition, &#8230; can be found in this class.</p></div>
<div class="paragraph"><p>Let us give a few example calls that should be self-explanatory.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Elements/SpaceElement.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Norms/Norm.hpp"</span>

<span style="color: #008080">SpaceElement_ptr_t</span> x<span style="color: #990000">,</span>y<span style="color: #990000">;</span>

<span style="font-style: italic"><span style="color: #9A1900">// linear algebra</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">double</span> scalar_product <span style="color: #990000">=</span> <span style="color: #990000">(*</span>x<span style="color: #990000">)</span>#  <span style="color: #990000">(*</span>y<span style="color: #990000">);</span>
<span style="color: #008080">SpaceElement_ptr_t</span> scalar_multiplication <span style="color: #990000">=</span> <span style="color: #993399">5</span><span style="color: #990000">.</span>#  <span style="color: #990000">(*</span>x<span style="color: #990000">);</span>
<span style="color: #008080">SpaceElement_ptr_t</span> addition <span style="color: #990000">=</span> <span style="color: #990000">(*</span>x<span style="color: #990000">)</span> <span style="color: #990000">+</span> <span style="color: #990000">(*</span>y<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">double</span> norm <span style="color: #990000">=</span> <span style="color: #990000">(*</span>x<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getSpace</span></span><span style="color: #990000">()-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getNorm</span></span><span style="color: #990000">())(</span>x<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">// access components</span></span>
<span style="color: #990000">(*</span>x<span style="color: #990000">)[</span><span style="color: #993399">5</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">5</span><span style="color: #990000">.;</span>
x<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">setZero</span></span><span style="color: #990000">();</span>

<span style="font-style: italic"><span style="color: #9A1900">// comparators</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">bool</span> equality <span style="color: #990000">=</span> <span style="color: #990000">(*</span>x<span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #990000">(*</span>y<span style="color: #990000">);</span>
<span style="font-style: italic"><span style="color: #9A1900">// don't; x == y (this compares the addresses in memory)</span></span>

<span style="font-style: italic"><span style="color: #9A1900">// print element</span></span>
std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span></tt></pre></div></div>
<div class="paragraph"><p>The association with the space prevents use in other spaces even if they share
the number of degrees of freedom.</p></div>
</div>
<div class="sect2">
<h3 id="reference.Norm">6.3. Norm</h3>
<div class="paragraph"><p>A norm basically has the single function to return the "norm" of a given
element. The <span class="monospaced">Norm</span> associated with a space makes it a <span class="monospaced">NormedSpace</span>, see
<span class="monospaced">getSpace()</span>.</p></div>
<div class="paragraph"><p>Note that certain norms cause spaces to be smooth or not. Hence, the norm can
be queried for <span class="monospaced">isSmooth()</span>.</p></div>
<div class="paragraph"><p><span class="monospaced">Norm</span> only defines the general interface. Specializations are <span class="monospaced">LpNorm</span>,
<span class="monospaced">L1Norm</span>, <span class="monospaced">LInfinityNorm</span> that implement the specific norm function to use.</p></div>
<div class="paragraph"><p>Norms throw an <span class="monospaced">NormIllegalValue_exception</span> when they are called with a
parameter outside expected intervals, e.g. an illegal p value such as -1.</p></div>
</div>
<div class="sect2">
<h3 id="reference.Mapping">6.4. Mapping</h3>
<div class="paragraph"><p>Similar to <span class="monospaced">Norm</span>, <span class="monospaced">Mapping</span> defines the general interface of a function that
maps an element from one <span class="monospaced">NormedSpace</span> onto another <span class="monospaced">NormedSpace</span> instance,
see <span class="monospaced">getSourceSpace()</span> and <span class="monospaced">getTargetSpace()</span>.
Therefore, its constructor requires a source and a target space instance.</p></div>
<div class="paragraph"><p>An example of such a mapping is the <span class="monospaced">LinearMapping</span>. This is a specialization
that implements a multiplication with a matrix associated with the mapping.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Elements/SpaceElement.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Mappings/LinearMappingFactory.hpp"</span>

<span style="color: #008080">NormedSpace_ptr_t</span> X<span style="color: #990000">,</span> Y<span style="color: #990000">;</span>
<span style="color: #008080">SpaceElement_ptr_t</span> x<span style="color: #990000">;</span>
Eigen<span style="color: #990000">::</span><span style="color: #008080">MatrixXd</span> matrix<span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// given from outside</span></span>

<span style="color: #008080">LinearMapping_ptr_</span> A <span style="color: #990000">=</span> LinearMappingFactory<span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">create</span></span><span style="color: #990000">(</span>X<span style="color: #990000">,</span>Y<span style="color: #990000">,</span> matrix<span style="color: #990000">);</span>

<span style="color: #008080">SpaceElement_ptr_t</span> y <span style="color: #990000">=</span> <span style="color: #990000">(*</span>A<span style="color: #990000">)(</span>x<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Its <span class="monospaced">operator()</span> then performs the actual mapping, taking a <span class="monospaced">SpaceElement</span> from
the source space <span class="monospaced">X</span>, performing alterations on the element&#8217;s components, and
returning a <span class="monospaced">SpaceElement</span> in the target space <span class="monospaced">Y</span>.</p></div>
<div class="paragraph"><p>A more complicated example for using the factory is as follows where we have two
matrices whose product forms the actual linear mapping.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;cassert&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Elements/SpaceElement.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Mappings/LinearMappingFactory.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Spaces/NormedSpace.hpp"</span>

<span style="color: #008080">NormedSpace_ptr_t</span> X<span style="color: #990000">,</span> Y<span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// instantiated before</span></span>
<span style="color: #008080">SpaceElement_ptr_t</span> x<span style="color: #990000">;</span>   <span style="font-style: italic"><span style="color: #9A1900">// instantiated before, associated with X</span></span>
<span style="font-weight: bold"><span style="color: #000000">assert</span></span> <span style="color: #990000">(</span> x<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getSpace</span></span><span style="color: #990000">()</span> <span style="color: #990000">==</span> X <span style="color: #990000">);</span>
Eigen<span style="color: #990000">::</span><span style="color: #008080">MatrixXd</span> factor_one<span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// given from outside</span></span>
Eigen<span style="color: #990000">::</span><span style="color: #008080">MatrixXd</span> factor_two<span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// given from outside</span></span>

<span style="color: #008080">LinearMapping_ptr_</span> A <span style="color: #990000">=</span> LinearMappingFactory<span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #000000">createTwoFactorInstance</span></span><span style="color: #990000">(</span>
    X<span style="color: #990000">,</span>Y<span style="color: #990000">,</span> factor_one<span style="color: #990000">,</span> factor_two<span style="color: #990000">);</span>

<span style="color: #008080">SpaceElement_ptr_t</span> y <span style="color: #990000">=</span> <span style="color: #990000">(*</span>A<span style="color: #990000">)(</span>x<span style="color: #990000">);</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Take care that the matrix dimensions match. Otherwise, an assertion is
thrown.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">A linear mapping can be decomposed into an singular value decomposition,
see <span class="monospaced">LinearMapping::getSVD()</span> and <span class="monospaced">SingularValueDecomposition</span>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Moreover, <span class="monospaced">DualityMapping</span> is another example of a <span class="monospaced">Mapping</span>. There, the
constructor only needs a single space as each space knows about its dual space
and this mapping always maps into the dual space. In the folder
<em>Mappings/Specifics</em> specific implementations of duality mapping, such as the
one in lp-spaces, are contained.</p></div>
<div class="paragraph"><p>Both these classes have specific factory classes, namely <span class="monospaced">LinearMappingFactory</span>
and <span class="monospaced">DualityMappingFactory</span> to create the respective instance types. These
factories are also used internally, e.g., when constructing the space with its
dual space and the associated duality mappings that all have to be interlinked.
To this end, these accept "weak" <span class="monospaced">NormedSpace</span> ptr instances.</p></div>
<div class="paragraph"><p>Finally, each mapping is inherently associated with an adjoint mapping. For
<span class="monospaced">LinearMapping</span> this would be the transposed of a (real-value) matrix.</p></div>
</div>
<div class="sect2">
<h3 id="reference.Functions">6.5. Functions</h3>
<div class="paragraph"><p>Functions are similar to <span class="monospaced">Mappings</span> and to <span class="monospaced">Norms</span>. They take one or two
arguments being <span class="monospaced">SpaceElement</span> instances and produce a real value.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">BregmanDistance</span>: calculates the Bregman distance between two elements of the
same space.
</p>
</li>
<li>
<p>
<span class="monospaced">ResidualFunctional</span>: calculates the residual $|Ax-y|$.
</p>
</li>
<li>
<p>
<span class="monospaced">SmoothnessFunctional</span>: calculates the modulus of smoothnes with a specific
lambda.
</p>
</li>
<li>
<p>
<span class="monospaced">SmoothnessModulus</span>: calculates the modulus of smoothness.
</p>
</li>
<li>
<p>
<span class="monospaced">VectorProjection</span>: calculates the projection of one element onto another.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let us give an example using the <span class="monospaced">BregmanDistance</span>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Minimizations/Elements/SpaceElement.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Minimizations/Functions/BregmanDistance.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Minimizations/Mappings/DualityMapping.hpp"</span>

<span style="color: #008080">Norm_ptr_t</span> norm<span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// instantiated before, e.g. Space::getNorm()</span></span>
<span style="color: #008080">DualityMapping_ptr_t</span> J_p<span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// instantiated before, e.g. Space::getDualityMapping()</span></span>
<span style="color: #008080">BregmanDistance</span> <span style="font-weight: bold"><span style="color: #000000">delta</span></span><span style="color: #990000">(</span>norm<span style="color: #990000">,</span> J_p<span style="color: #990000">,</span> J_p<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getPower</span></span><span style="color: #990000">());</span>

<span style="color: #008080">SpaceElement_ptr_t</span> x<span style="color: #990000">,</span>y<span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// instantiated before</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">double</span> bregman_distance <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">delta</span></span><span style="color: #990000">(</span>x<span style="color: #990000">,</span>y<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Some functions are used solely internally, namely for minimization.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">BregmanProjectionFunctional</span>
</p>
</li>
<li>
<p>
<span class="monospaced">MetricProjectionFunctional</span>
</p>
</li>
<li>
<p>
<span class="monospaced">VectorProjection_BregmanDistanceToLine</span>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="reference.MatrixIO">6.6. MatrixIO</h3>
<div class="paragraph"><p><span class="monospaced">MatrixIO</span> is a namespace wherein several helper functions are gathered that
read or write matrix from or to files. Moreover, there are helper functions to
print matrices to output streams.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">We use the Matlab/Octave text format to read and write matrices. This
can be easily extended to also parse binary formats.</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;Eigen/Dense&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"MatrixIO/MatrixIO.hpp"</span>

Eigen<span style="color: #990000">::</span><span style="color: #008080">VectorXd</span> solution<span style="color: #990000">;</span>

<span style="font-style: italic"><span style="color: #9A1900">// parse from Octave-style file</span></span>
MatrixIO<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"start_solution.m"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"rhs"</span><span style="color: #990000">,</span> solution<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">// write to Octave-style file</span></span>
MatrixIO<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">store</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"solution.m"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"rhs"</span><span style="color: #990000">,</span> solution<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>This will parse a vector from the file <em>start_solution.m</em> into the
<span class="monospaced">Eigen::VectorXd</span> instance named <span class="monospaced">solution</span>. Here, <strong>rhs</strong> is used in error
messages when parsing, e.., when the file does not exist.
Similary, we write the vector into <em>solution.m</em> from the same instance.</p></div>
<div class="paragraph"><p>When writing <span class="monospaced">SpaceElement`s (instead of `Eigen::VectorXd</span>) we recommend using
the convenience class <span class="monospaced">SpaceElementWriter</span>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;fstream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Minimizations/Elements/SpaceElementIO.hpp"</span>
<span style="color: #008080">SpaceElement_ptr_t</span> solution<span style="color: #990000">;</span>

<span style="font-style: italic"><span style="color: #9A1900">// parse from file</span></span>
std<span style="color: #990000">::</span><span style="color: #008080">ifstream</span> <span style="font-weight: bold"><span style="color: #000000">ist</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"start_solution.m"</span><span style="color: #990000">);</span>
SpaceElementWriter<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">input</span></span><span style="color: #990000">(</span>ist<span style="color: #990000">,</span> solution<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">// write to file</span></span>
std<span style="color: #990000">::</span><span style="color: #008080">ofstream</span> <span style="font-weight: bold"><span style="color: #000000">ost</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"solutionm.m"</span><span style="color: #990000">);</span>
SpaceElementWriter<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">output</span></span><span style="color: #990000">(</span>ost<span style="color: #990000">,</span> solution<span style="color: #990000">);</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="reference.InverseProblem">6.7. InverseProblem</h3>
<div class="paragraph"><p>The <span class="monospaced">InverseProblem</span> class takes a mapping, two space instances, and a
right-hand side. It is simply a convenience struct that keeps all the necessary
references at hand, namely it constructs internal shorthand references to all
items required for the minimizations methods such as the dual spaces, the
adjoint mapping. Moreover, it contains the solution element to be found.</p></div>
</div>
<div class="sect2">
<h3 id="reference.Minimizers">6.8. Minimizers</h3>
<div class="paragraph"><p>Minimizers form the core of BASSO. They solve the minimizations problems that
produce solutions to inverse problems or split feasibility problems.</p></div>
<div class="paragraph"><p>The general interface is defined in <span class="monospaced">GeneralMinimizer</span>. Its constructor takes
all controlling parameters in the form of <span class="monospaced">CommandLineOptions</span> and moreover
an <span class="monospaced">InverseProblem</span> instance and a <span class="monospaced">Database</span> whereto iteration-related
information is stored.
Its <span class="monospaced">operator()</span> expects the inverse problem (as you may change the matrix A
and the right), a starting value together with its dual starting value and a
possibly known solution to calculate the Bregman distance to it.</p></div>
<div class="paragraph"><p>The following minimizers are implemented:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">LandweberMinimizer</span>
</p>
<div class="paragraph"><p>The Landweber method is the traditional method of inverse problems for which
strong convergence was shown first. In practice, it is known to converge very
slowly. This is especially true when a fixed step width is used. However, even
with a line search such as using Brent&#8217;s method it is not competitive with the
other SESOP Minimizers. One advantage is naturally that it does not need any
derivative information, i.e. it works even when the space X is not smooth such
as in case of the \ell_1-norm.</p></div>
</li>
<li>
<p>
<span class="monospaced">SequentialSubspaceMinimizer</span>
</p>
<div class="paragraph"><p>The Sequential Subspace Method (SESOP) is the main workhorse in BASSO. It can
employ multiple search directions that can even be made (g-)orthogonal in the
context of Banach space to speed up convergence. Note that SESOP is constrained
to uniformly smooth and convex Banach spaces, i.e. p \in (1,\infty).
Current work is underway to extend to the uniformly convex Banach spaces.</p></div>
</li>
<li>
<p>
<span class="monospaced">SequentialSubspaceMinimizerNoise</span>
</p>
<div class="paragraph"><p>This is variant of SESOP with additional regularization. In other words, it may
be used for perturbed right-hand sides. Moreover, this variant is suited also
for non-linear minimization, see <a href="#Wald2017">[Wald2017</a>].</p></div>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>Empirical tests have shown that multiple orthogonal search directions in
lp-spaces are only efficient for p&gt;3. If p is smaller only a single
search direction is recommended as more search directions just bring additional
complexity (because of the additional orthogonalization operations) but do not
increase convergence speed. See <a href="#Heber2019">[Heber2019</a>] for details.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>These Minimizers may be cleanly instantiated using the <span class="monospaced">MinimizerFactory</span>.</p></div>
<div class="paragraph"><p>An important point is how the step width is determined. This is especially
important for the <span class="monospaced">LandweberMinimizer</span>. There are several different variants
implemented. All of which can be easily accessed through the
<span class="monospaced">DetermineStepWidthFactory</span>.</p></div>
<div class="paragraph"><p>The SESOP Minimizers determine the step width automatically through a line
search. However, this line search may be tuned to be only inexact by setting
appropriate Wolfe conditions.</p></div>
<div class="paragraph"><p>All Minimizers write information about the iteration to tables of a database.
The <span class="monospaced">DatabaseManager</span> controls what values are written and how the tables are
set up.</p></div>
</div>
<div class="sect2">
<h3 id="reference.CommandLineOptions">6.9. CommandLineOptions</h3>
<div class="paragraph"><p>Many parameters that control how for example the minimization is performed
are wrapped in a class <span class="monospaced">CommandLineOptions</span>.</p></div>
<div class="paragraph"><p>Let us briefly discuss what the class looks like and what it can do.</p></div>
<div class="paragraph"><p>First of all, <span class="monospaced">CommandLineOptions</span> is basically a <span class="monospaced">struct</span> containing all sorts
of parameters that control what Banach spaces (and what norms) are employed,
what kind of Minimizer, what stopping criteria and so on.</p></div>
<div class="paragraph"><p>Furthermore, the class has helper functions to quickly parse the state from
given command-line options. This explains the nature of its name.</p></div>
<div class="paragraph"><p>Moreover, the class' state can be stored to a human-readable file using
<span class="monospaced">boost::serialization</span>. It is written as in the following example code.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;boost/progam_options.hpp&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;fstream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Options/CommandLineOptions.hpp"</span>

<span style="font-weight: bold"><span style="color: #0000FF">using</span></span> <span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> boost<span style="color: #990000">::</span>program_options <span style="color: #008080">as</span> po<span style="color: #990000">;</span>

<span style="color: #008080">CommandLineOptions</span> opts<span style="color: #990000">;</span>

<span style="font-style: italic"><span style="color: #9A1900">// write to file</span></span>
std<span style="color: #990000">::</span><span style="color: #008080">ofstream</span> <span style="font-weight: bold"><span style="color: #000000">config_file</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"config.cfg"</span><span style="color: #990000">);</span>
opts<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">store</span></span><span style="color: #990000">(</span>config_file<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">// read from file</span></span>
std<span style="color: #990000">::</span><span style="color: #008080">ifstream</span> <span style="font-weight: bold"><span style="color: #000000">config_file</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"config.cfg"</span><span style="color: #990000">);</span>
po<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">store</span></span><span style="color: #990000">(</span>po<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">parse_config_file</span></span><span style="color: #990000">(</span>config_file<span style="color: #990000">,</span> opts<span style="color: #990000">.</span>desc_all<span style="color: #990000">),</span> opts<span style="color: #990000">.</span>vm<span style="color: #990000">);</span>
po<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">notify</span></span><span style="color: #990000">(</span>vm<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Finally, <span class="monospaced">CommandLineOptions</span> has functions to check the validity of each
parameter.</p></div>
</div>
<div class="sect2">
<h3 id="reference.StoppingCriterion">6.10. StoppingCriterion</h3>
<div class="paragraph"><p>A <span class="monospaced">StoppingCriterion</span> takes several values related to the iteration, namely
the time passed, the number of outer iterations, the current residuum and
the norm of the right-hand side, and decides whether it is time to stop or not.</p></div>
<div class="paragraph"><p>There are several primities such as <span class="monospaced">CheckRelativeResiduum</span> or <span class="monospaced">CheckWalltime</span>
that may be arbitrarily combined using boolean logic.</p></div>
<div class="paragraph"><p>It is simplest to employ the factory for producing such a combined stopping
criterion. It creates the instance from a simple string as follows.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Minimizations/Minimizers/StoppingCriteria/StoppingArguments.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Minimizations/Minimizers/StoppingCriteria/StoppingCriteriaFactory.hpp"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Minimizations/Minimizers/StoppingCriteria/StoppingCriterion.hpp"</span>

<span style="color: #008080">StoppingArguments</span> args<span style="color: #990000">;</span>
args<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setMaxIterations</span></span><span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">);</span>

StoppingCriterion<span style="color: #990000">::</span><span style="color: #008080">ptr_t</span> criterion <span style="color: #990000">=</span> StoppingCriteriaFactory<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">create</span></span><span style="color: #990000">(</span>
  <span style="color: #FF0000">"MaxIterationCount || DivergentResiduum"</span><span style="color: #990000">,</span>
  args
  <span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This will stop either after 100 iterations or when the residuum diverges more
than three times (i.e. increases instead of decreases).</p></div>
<div class="paragraph"><p>See the <span class="monospaced">StoppingCriteriaFactory::StoppingCriteriaFactory()</span> for a list of all
known criterion and boolean operators (they are the familar ones from cpp).</p></div>
</div>
<div class="sect2">
<h3 id="reference.Solvers">6.11. Solvers</h3>
<div class="paragraph"><p>The general interface to all solvers is defined in <span class="monospaced">FeasibilityProblem</span>. It is
basically simply a functor, i.e. having a single <span class="monospaced">operator()</span> function that
executes the solving.</p></div>
<div class="paragraph"><p>There are some convenience functions such as <span class="monospaced">getName()</span> which returns a human
readable name for output purposes. <span class="monospaced">clear()</span> and <span class="monospaced">finish()</span> are used when doing
split feasibility problems with multiple iterations.</p></div>
<div class="paragraph"><p>Then we have several specific solvers which we discuss each in turn:</p></div>
<div class="sect3">
<h4 id="reference.solvers.InverseProblemSolver">6.11.1. InverseProblemSolver</h4>
<div class="paragraph"><p>The <span class="monospaced">InverseProblemSolver</span> class takes an inverse problem and applies a
minimizer method. Additionally, it connects with a <span class="monospaced">Database</span> class to write
iteration-specific information to that. This allows to check on the quality of
the iteration process lateron.</p></div>
<div class="paragraph"><p>The parameters that control the manner of the solving, e.g., the minimizer
method and its options, are given using a <span class="monospaced">CommandLineOptions</span> instance.</p></div>
</div>
<div class="sect3">
<h4 id="reference.solvers.RangeProjectionSolver">6.11.2. RangeProjectionSolver</h4>
<div class="paragraph"><p>The <span class="monospaced">RangeProjectionSolver</span> class directly takes a matrix and a right-hand side
and constructs internal spaces for the projection depending on the given
options in the <span class="monospaced">CommandLineOptions</span> class. It is very similar to an
<span class="monospaced">InverseProblemSolver</span>.</p></div>
</div>
<div class="sect3">
<h4 id="reference.solvers.AuxiliaryConstraints">6.11.3. AuxiliaryConstraints</h4>
<div class="paragraph"><p>An <span class="monospaced">AuxiliaryConstraints</span> is a functor using a <span class="monospaced">SpaceElement</span> that enforces a
certain restriction directly on the element. E.g., <span class="monospaced">NonnegativeConstraint</span> will
project the vector onto the positive orthant, i.e. all negative components
become zero.</p></div>
<div class="paragraph"><p>They are used in the context of <span class="monospaced">SplitFeasibilitySolvers</span>.</p></div>
<div class="paragraph"><p>These constraints can be combined using boolean <strong>AND</strong>. Let us give an example
where we use the <span class="monospaced">AuxiliaryConstraintsFactory</span></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"Solvers/AuxiliaryConstraints/AuxiliaryConstraintsFactory.hpp"</span>

<span style="font-style: italic"><span style="color: #9A1900">// create a single non-negative criterion</span></span>
AuxiliaryConstraints<span style="color: #990000">::</span><span style="color: #008080">ptr_t</span> nonneg_criterion <span style="color: #990000">=</span>
  AuxiliaryConstraintsFactory<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">createCriterion</span></span><span style="color: #990000">(</span>
    AuxiliaryConstraintsFactory<span style="color: #990000">::</span>Nonnegative<span style="color: #990000">);</span>
AuxiliaryConstraints<span style="color: #990000">::</span><span style="color: #008080">ptr_t</span> unit_criterion <span style="color: #990000">=</span>
  AuxiliaryConstraintsFactory<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">createCriterion</span></span><span style="color: #990000">(</span>
    AuxiliaryConstraintsFactory<span style="color: #990000">::</span>Unity<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">// create a combination of non-negative and unit</span></span>
AuxiliaryConstraints<span style="color: #990000">::</span><span style="color: #008080">ptr_t</span> combined_criterion <span style="color: #990000">=</span>
AuxiliaryConstraintsFactory<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">createCombination</span></span><span style="color: #990000">(</span>
      AuxiliaryConstraintsFactory<span style="color: #990000">::</span>Combination_AND<span style="color: #990000">,</span>
      nonneg_criterion<span style="color: #990000">,</span> unit_criterion<span style="color: #990000">);</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">This can be done directly from a string "Nonnegative &amp;&amp; Unity" using <span class="monospaced">AuxiliaryConstraintsFactory::create()</span>.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="reference.solvers.SplitFeasibilitySolver">6.11.4. SplitFeasibilitySolver</h4>
<div class="paragraph"><p>A <span class="monospaced">SplitFeasibilitySolver</span> is a queue for a number of <span class="monospaced">FeasibilityProblem</span> or
<span class="monospaced">AuxiliaryConstraints</span>.
They are registered with this queue by using <span class="monospaced">registerFeasibilityProblem()</span> and
<span class="monospaced">registerAuxiliaryConstraints()</span>, respectively.</p></div>
<div class="paragraph"><p>The problems are each solved approximately in turn. The queue is repeated over
for as many <strong>loops</strong> as desired or until a given <span class="monospaced">StoppingCriterion</span> returns
true.</p></div>
<div class="paragraph"><p>These split feasibility problems are employed in the context of matrix
factorization but can also be used in inverse problems when additional
constraints apart from the minimum-norm solution requirement need to be
enforced.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_to_do">7. To Do</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">GeneralMinimizer</span>'s takes the <span class="monospaced">InverseProblem</span> only out of convenience but it
is hard to understand why it needs it again in <span class="monospaced">operator()</span>. Cstor might get
away with just getting a space?
</p>
</li>
<li>
<p>
<span class="monospaced">FeasibilityProblem::clear()</span> and <span class="monospaced">::finish()</span> can possibly be made protected
as user access is not needed.
</p>
</li>
<li>
<p>
Remove the extra two space arguments in the cstor of <span class="monospaced">InverseProblem</span>. They
can be deduced from the Mapping.
</p>
</li>
<li>
<p>
Split <span class="monospaced">Parameters</span> of <span class="monospaced">CommandLineOptions</span> to disassociate from
command-line context. The former only contains Serialization. Note that there
is already an <span class="monospaced">Options</span> class that does the storing.
</p>
</li>
<li>
<p>
<span class="monospaced">Options</span> should have a convenience function <span class="monospaced">parse()</span> similar to <span class="monospaced">store()</span>, see
<span class="monospaced">Options::parse()</span> in "config" branch.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements">Acknowledgements</h2>
<div class="sectionbody">
<div class="paragraph"><p>Thanks to all the users of the library!</p></div>
</div>
</div>
<div class="sect1">
<h2 id="bibliography">Literature</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<a id="Cioranescu1990"></a> Cioranescu, I. (1990).
Geometry of Banach Spaces, Duality Mappings and Nonlinear Problems (1.).
Dordrecht, The Netherlands: Kluwer Academic Publishers.
</p>
</li>
<li>
<p>
<a id="Hansen2010"></a> Hansen, P. C. (2010).
Discrete Inverse Problems - Insight and Algorithms (1st ed.).
SIAM.
</p>
</li>
<li>
<p>
<a id="Heber2016"></a> Heber, F., Schpfer, F., &amp; Schuster, T. (2016).
A CG-type method in Banach spaces with an application to computerized tomography.
Retrieved from <a href="http://arxiv.org/abs/1602.04036">http://arxiv.org/abs/1602.04036</a>
</p>
</li>
<li>
<p>
<a id="Heber2019"></a> Heber, F., Schpfer, F., &amp; Schuster, T. (2019).
Acceleration of sequential subspace optimization in Banach spaces by orthogonal search directions.
Journal of Computational and Applied Mathematics, 345, 122. <a href="http://doi.org/10.1016/j.cam.2018.05.049">http://doi.org/10.1016/j.cam.2018.05.049</a>
</p>
</li>
<li>
<p>
<a id="Schuster2012"></a> Schuster, T., Kaltenbacher, B., Hofmann, B. &amp; Kazimierski, K. S. (2012).
Regularization Methods in Banach Spaces.
De Gruyter.
</p>
</li>
<li>
<p>
<a id="Schoepfer2006"></a> Schpfer, F., Louis, A. K., &amp; Schuster, T. (2006).
Nonlinear iterative methods for linear ill-posed problems in Banach spaces.
Inverse Problems, 22(1), 311329. <a href="http://doi.org/10.1088/0266-5611/22/1/017">http://doi.org/10.1088/0266-5611/22/1/017</a>
</p>
</li>
<li>
<p>
<a id="Schoepfer2008"></a> Schpfer, F., Schuster, T., &amp; Louis, A. K. (2008).
Metric and Bregman projections onto affine subspaces and their computation via sequential subspace optimization methods.
Journal of Inverse and Ill-Posed Problems, 16(5), 129. <a href="http://doi.org/10.1515/JIIP.2008.026">http://doi.org/10.1515/JIIP.2008.026</a>
</p>
</li>
<li>
<p>
<a id="Schoepfer2009"></a> Schpfer, F., &amp; Schuster, T. (2009).
Fast regularizing sequential subspace optimization in Banach spaces.
Inverse Problems, 25(1), 122. <a href="http://doi.org/10.1088/0266-5611/25/1/015013">http://doi.org/10.1088/0266-5611/25/1/015013</a>
</p>
</li>
<li>
<p>
[Wald2017]] Wald, A., &amp; Schuster, T. (2017).
Sequential subspace optimization for nonlinear inverse problems.
Journal of Inverse and Ill-Posed Problems, 25(1), 99117. <a href="http://doi.org/10.1515/jiip-2016-0014">http://doi.org/10.1515/jiip-2016-0014</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Version 1.11.1<br>
Last updated
 2019-04-10 15:11:27 CEST
</div>
</div>
</body>
</html>
